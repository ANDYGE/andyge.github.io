<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"swiftist.cn","root":"/","scheme":"Pisces","version":"7.7.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"appID":"EVBR3H53HW","apiKey":"2abd573a01143a0cc4108fa4d21ae67c","indexName":"swiftist","hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="勇于积极进取，步入人生的世外桃源">
<meta property="og:type" content="website">
<meta property="og:title" content="飞雪轩辕">
<meta property="og:url" content="https://swiftist.cn/page/52/index.html">
<meta property="og:site_name" content="飞雪轩辕">
<meta property="og:description" content="勇于积极进取，步入人生的世外桃源">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Andy Ge">
<meta property="article:tag" content="技术博客">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://swiftist.cn/page/52/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false
  };
</script>

  <title>飞雪轩辕</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="飞雪轩辕" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">飞雪轩辕</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">人生的乐趣在于把梦想变成现实</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-java">

    <a href="/categories/java/" rel="section"><i class="fa fa-fw fa-th-large"></i>java</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://swiftist.cn/2018/12/30/redis/StringRedisTemplate%E6%93%8D%E4%BD%9Credis%E6%95%B0%E6%8D%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Andy Ge">
      <meta itemprop="description" content="勇于积极进取，步入人生的世外桃源">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="飞雪轩辕">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/12/30/redis/StringRedisTemplate%E6%93%8D%E4%BD%9Credis%E6%95%B0%E6%8D%AE/" class="post-title-link" itemprop="url">StringRedisTemplate操作redis数据</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-12-30 10:35:24" itemprop="dateCreated datePublished" datetime="2018-12-30T10:35:24+08:00">2018-12-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-03-31 23:07:39" itemprop="dateModified" datetime="2020-03-31T23:07:39+08:00">2020-03-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/redis/" itemprop="url" rel="index">
                    <span itemprop="name">redis</span>
                  </a>
                </span>
            </span>

          
            <span id="/2018/12/30/redis/StringRedisTemplate%E6%93%8D%E4%BD%9Credis%E6%95%B0%E6%8D%AE/" class="post-meta-item leancloud_visitors" data-flag-title="StringRedisTemplate操作redis数据" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="StringRedisTemplate-与-RedisTemplate-区别点"><a href="#StringRedisTemplate-与-RedisTemplate-区别点" class="headerlink" title="StringRedisTemplate 与 RedisTemplate 区别点"></a>StringRedisTemplate 与 RedisTemplate 区别点</h1><ul>
<li>两者的关系是 StringRedisTemplate 继承 RedisTemplate。</li>
<li>两者的数据是不共通的；也就是说 StringRedisTemplate 只能管理 StringRedisTemplate 里面的数据，RedisTemplate 只能管理 RedisTemplate 中的数据。</li>
<li>其实他们两者之间的区别主要在于他们使用的序列化类:<ul>
<li>RedisTemplate 使用的是 JdkSerializationRedisSerializer 存入数据会将数据先序列化成字节数组然后在存入 Redis 数据库。</li>
<li>StringRedisTemplate 使用的是 StringRedisSerializer</li>
</ul>
</li>
<li>使用时注意事项：<ul>
<li>当你的 redis 数据库里面本来存的是字符串数据或者你要存取的数据就是字符串类型数据的时候，那么你就使用 StringRedisTemplate 即可。</li>
<li>但是如果你的数据是复杂的对象类型，而取出的时候又不想做任何的数据转换，直接从 Redis 里面取出一个对象，那么使用 RedisTemplate 是更好的选择。</li>
</ul>
</li>
<li>RedisTemplate 使用时常见问题：<ul>
<li>redisTemplate 中存取数据都是字节数组。当 redis 中存入的数据是可读形式而非字节数组时，使用 redisTemplate 取值的时候会无法获取导出数据，获得的值为 null。可以使用 StringRedisTemplate 试试。</li>
</ul>
</li>
</ul>
<h1 id="RedisTemplate-中定义了-5-种数据结构操作"><a href="#RedisTemplate-中定义了-5-种数据结构操作" class="headerlink" title="RedisTemplate 中定义了 5 种数据结构操作"></a>RedisTemplate 中定义了 5 种数据结构操作</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">redisTemplate.opsForValue();　　<span class="comment">//操作字符串</span></span><br><span class="line">redisTemplate.opsForHash();　　 <span class="comment">//操作hash</span></span><br><span class="line">redisTemplate.opsForList();　　 <span class="comment">//操作list</span></span><br><span class="line">redisTemplate.opsForSet();　　  <span class="comment">//操作set</span></span><br><span class="line">redisTemplate.opsForZSet();　 　<span class="comment">//操作有序set</span></span><br></pre></td></tr></table></figure>

<h1 id="StringRedisTemplate-常用操作"><a href="#StringRedisTemplate-常用操作" class="headerlink" title="StringRedisTemplate 常用操作"></a>StringRedisTemplate 常用操作</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">stringRedisTemplate.opsForValue().set(<span class="string">"test"</span>, <span class="string">"100"</span>,<span class="number">60</span>*<span class="number">10</span>,TimeUnit.SECONDS);<span class="comment">//向redis里存入数据和设置缓存时间</span></span><br><span class="line"></span><br><span class="line">stringRedisTemplate.boundValueOps(<span class="string">"test"</span>).increment(-<span class="number">1</span>);<span class="comment">//val做-1操作</span></span><br><span class="line"></span><br><span class="line">stringRedisTemplate.opsForValue().get(<span class="string">"test"</span>)<span class="comment">//根据key获取缓存中的val</span></span><br><span class="line"></span><br><span class="line">stringRedisTemplate.boundValueOps(<span class="string">"test"</span>).increment(<span class="number">1</span>);<span class="comment">//val +1</span></span><br><span class="line"></span><br><span class="line">stringRedisTemplate.getExpire(<span class="string">"test"</span>)<span class="comment">//根据key获取过期时间</span></span><br><span class="line"></span><br><span class="line">stringRedisTemplate.getExpire(<span class="string">"test"</span>,TimeUnit.SECONDS)<span class="comment">//根据key获取过期时间并换算成指定单位</span></span><br><span class="line"></span><br><span class="line">stringRedisTemplate.delete(<span class="string">"test"</span>);<span class="comment">//根据key删除缓存</span></span><br><span class="line"></span><br><span class="line">stringRedisTemplate.hasKey(<span class="string">"546545"</span>);<span class="comment">//检查key是否存在，返回boolean值</span></span><br><span class="line"></span><br><span class="line">stringRedisTemplate.opsForSet().add(<span class="string">"red_123"</span>, <span class="string">"1"</span>,<span class="string">"2"</span>,<span class="string">"3"</span>);<span class="comment">//向指定key中存放set集合</span></span><br><span class="line"></span><br><span class="line">stringRedisTemplate.expire(<span class="string">"red_123"</span>,<span class="number">1000</span> , TimeUnit.MILLISECONDS);<span class="comment">//设置过期时间</span></span><br><span class="line"></span><br><span class="line">stringRedisTemplate.opsForSet().isMember(<span class="string">"red_123"</span>, <span class="string">"1"</span>)<span class="comment">//根据key查看集合中是否存在指定数据</span></span><br><span class="line"></span><br><span class="line">stringRedisTemplate.opsForSet().members(<span class="string">"red_123"</span>);<span class="comment">//根据key获取set集合</span></span><br></pre></td></tr></table></figure>

<h1 id="StringRedisTemplate-的使用"><a href="#StringRedisTemplate-的使用" class="headerlink" title="StringRedisTemplate 的使用"></a>StringRedisTemplate 的使用</h1><p>springboot 中使用注解@Autowired 即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/user"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserResource</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger log = LoggerFactory.getLogger(UserResource<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/num"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">countNum</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String userNum = stringRedisTemplate.opsForValue().get(<span class="string">"userNum"</span>);</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isNull(userNum))&#123;</span><br><span class="line">            stringRedisTemplate.opsForValue().set(<span class="string">"userNum"</span>, userService.countNum().toString());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>  userNum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://swiftist.cn/2018/12/29/es/10%E5%88%86%E9%92%9F%E4%BA%86%E8%A7%A3JSON-Web%E4%BB%A4%E7%89%8C%EF%BC%88JWT%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Andy Ge">
      <meta itemprop="description" content="勇于积极进取，步入人生的世外桃源">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="飞雪轩辕">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/12/29/es/10%E5%88%86%E9%92%9F%E4%BA%86%E8%A7%A3JSON-Web%E4%BB%A4%E7%89%8C%EF%BC%88JWT%EF%BC%89/" class="post-title-link" itemprop="url">10分钟了解JSON Web令牌（JWT）</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-12-29 10:31:48" itemprop="dateCreated datePublished" datetime="2018-12-29T10:31:48+08:00">2018-12-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-03-31 23:07:39" itemprop="dateModified" datetime="2020-03-31T23:07:39+08:00">2020-03-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/owl/" itemprop="url" rel="index">
                    <span itemprop="name">owl</span>
                  </a>
                </span>
            </span>

          
            <span id="/2018/12/29/es/10%E5%88%86%E9%92%9F%E4%BA%86%E8%A7%A3JSON-Web%E4%BB%A4%E7%89%8C%EF%BC%88JWT%EF%BC%89/" class="post-meta-item leancloud_visitors" data-flag-title="10分钟了解JSON Web令牌（JWT）" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="/images/owl/u=223903978,388360724&fm=173&app=25&f=JPEG.jpg" alt="配图"></p>
<p>JSON Web Token（JWT）是目前最流行的跨域身份验证解决方案。虫虫今天给大家介绍JWT的原理和用法。</p>
<h1 id="1-跨域身份验证"><a href="#1-跨域身份验证" class="headerlink" title="1. 跨域身份验证"></a>1. 跨域身份验证</h1><p>Internet服务无法与用户身份验证分开。一般过程如下。</p>
<ol>
<li><p>用户向服务器发送用户名和密码。</p>
</li>
<li><p>验证服务器后，相关数据（如用户角色，登录时间等）将保存在当前会话中。</p>
</li>
<li><p>服务器向用户返回session_id，session信息都会写入到用户的Cookie。</p>
</li>
<li><p>用户的每个后续请求都将通过在Cookie中取出session_id传给服务器。</p>
</li>
<li><p>服务器收到session_id并对比之前保存的数据，确认用户的身份。</p>
</li>
</ol>
<p><img src="../../images/owl/u=81505614,2635154874&fm=173&app=25&f=JPEG.jpg" alt="流程图"></p>
<p>这种模式最大的问题是，没有分布式架构，无法支持横向扩展。如果使用一个服务器，该模式完全没有问题。但是，如果它是服务器群集或面向服务的跨域体系结构的话，则需要一个统一的session数据库库来保存会话数据实现共享，这样负载均衡下的每个服务器才可以正确的验证用户身份。</p>
<p>例如虫虫举一个实际中常见的单点登陆的需求：站点A和站点B提供同一公司的相关服务。现在要求用户只需要登录其中一个网站，然后它就会自动登录到另一个网站。怎么做？</p>
<p>一种解决方案是听过持久化session数据，写入数据库或文件持久层等。收到请求后，验证服务从持久层请求数据。该解决方案的优点在于架构清晰，而缺点是架构修改比较费劲，整个服务的验证逻辑层都需要重写，工作量相对较大。而且由于依赖于持久层的数据库或者问题系统，会有单点风险，如果持久层失败，整个认证体系都会挂掉。</p>
<p><img src="../../images/owl/u=1542585179,3885887088&fm=173&app=25&f=JPEG.jpg" alt="部署示意图"></p>
<p>本文虫虫给大家介绍另外一种灵活的解决方案，通过客户端保存数据，而服务器根本不保存会话数据，每个请求都被发送回服务器。 JWT是这种解决方案的代表。</p>
<p><img src="../../images/owl/u=2871748982,2552404266&fm=173&app=25&f=JPEG.jpg" alt="时序图"></p>
<h1 id="2-JWT的原则"><a href="#2-JWT的原则" class="headerlink" title="2. JWT的原则"></a>2. JWT的原则</h1><p>JWT的原则是在服务器身份验证之后，将生成一个JSON对象并将其发送回用户，如下所示。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"UserName"</span>: <span class="string">"Chongchong"</span>,</span><br><span class="line">    <span class="attr">"Role"</span>: <span class="string">"Admin"</span>,</span><br><span class="line">    <span class="attr">"Expire"</span>: <span class="string">"2018-08-08 20:15:56"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>之后，当用户与服务器通信时，客户在请求中发回JSON对象。服务器仅依赖于这个JSON对象来标识用户。为了防止用户篡改数据，服务器将在生成对象时添加签名（有关详细信息，请参阅下文）。</p>
<p>服务器不保存任何会话数据，即服务器变为无状态，使其更容易扩展。</p>
<h1 id="3-JWT的数据结构"><a href="#3-JWT的数据结构" class="headerlink" title="3. JWT的数据结构"></a>3. JWT的数据结构</h1><p>典型的，一个JWT看起来如下图。</p>
<p>改对象为一个很长的字符串，字符之间通过”.”分隔符分为三个子串。注意JWT对象为一个长字串，各字串之间也没有换行符，此处为了演示需要，我们特意分行并用不同颜色表示了。每一个子串表示了一个功能块，总共有以下三个部分：</p>
<p>JWT的三个部分如下。JWT头、有效载荷和签名，将它们写成一行如下。</p>
<p><img src="../../images/owl/u=563276735,1576219691&fm=173&app=25&f=JPEG.jpg" alt="JWT结构图"></p>
<p>我们将在下面介绍这三个部分。</p>
<h2 id="3-1-JWT头"><a href="#3-1-JWT头" class="headerlink" title="3.1. JWT头"></a>3.1. JWT头</h2><p>JWT头部分是一个描述JWT元数据的JSON对象，通常如下所示。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"alg"</span>: <span class="string">"HS256"</span>,</span><br><span class="line">    <span class="attr">"typ"</span>: <span class="string">"JWT"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在上面的代码中，alg属性表示签名使用的算法，默认为HMAC SHA256（写为HS256）；typ属性表示令牌的类型，JWT令牌统一写为JWT。</p>
<p>最后，使用Base64 URL算法将上述JSON对象转换为字符串保存。</p>
<h2 id="3-2-有效载荷"><a href="#3-2-有效载荷" class="headerlink" title="3.2. 有效载荷"></a>3.2. 有效载荷</h2><p>有效载荷部分，是JWT的主体内容部分，也是一个JSON对象，包含需要传递的数据。 JWT指定七个默认字段供选择。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">iss：发行人</span><br><span class="line"></span><br><span class="line">exp：到期时间</span><br><span class="line"></span><br><span class="line">sub：主题</span><br><span class="line"></span><br><span class="line">aud：用户</span><br><span class="line"></span><br><span class="line">nbf：在此之前不可用</span><br><span class="line"></span><br><span class="line">iat：发布时间</span><br><span class="line"></span><br><span class="line">jti：JWT ID用于标识该JWT</span><br></pre></td></tr></table></figure>

<p>除以上默认字段外，我们还可以自定义私有字段，如下例：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"sub"</span>: <span class="string">"1234567890"</span>,</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"chongchong"</span>,</span><br><span class="line">    <span class="attr">"admin"</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>请注意，默认情况下JWT是未加密的，任何人都可以解读其内容，因此不要构建隐私信息字段，存放保密信息，以防止信息泄露。</p>
<p>JSON对象也使用Base64 URL算法转换为字符串保存。</p>
<h2 id="3-3-签名哈希"><a href="#3-3-签名哈希" class="headerlink" title="3.3. 签名哈希"></a>3.3. 签名哈希</h2><p>签名哈希部分是对上面两部分数据签名，通过指定的算法生成哈希，以确保数据不会被篡改。</p>
<p>首先，需要指定一个密码（secret）。该密码仅仅为保存在服务器中，并且不能向用户公开。然后，使用标头中指定的签名算法（默认情况下为HMAC SHA256）根据以下公式生成签名。</p>
<p>HMACSHA256(base64UrlEncode(header) + “.” + base64UrlEncode(payload),</p>
<p>secret)</p>
<p>在计算出签名哈希后，JWT头，有效载荷和签名哈希的三个部分组合成一个字符串，每个部分用”.”分隔，就构成整个JWT对象。</p>
<h2 id="3-4-Base64URL算法"><a href="#3-4-Base64URL算法" class="headerlink" title="3.4. Base64URL算法"></a>3.4. Base64URL算法</h2><p>如前所述，JWT头和有效载荷序列化的算法都用到了Base64URL。该算法和常见Base64算法类似，稍有差别。</p>
<p>作为令牌的JWT可以放在URL中（例如api.example/?token=xxx）。 Base64中用的三个字符是”+”，”/“和”=”，由于在URL中有特殊含义，因此Base64URL中对他们做了替换：”=”去掉，”+”用”-“替换，”/“用”_”替换，这就是Base64URL算法，很简单把。</p>
<h1 id="4-JWT的用法"><a href="#4-JWT的用法" class="headerlink" title="4. JWT的用法"></a>4. JWT的用法</h1><p>客户端接收服务器返回的JWT，将其存储在Cookie或localStorage中。</p>
<p>此后，客户端将在与服务器交互中都会带JWT。如果将它存储在Cookie中，就可以自动发送，但是不会跨域，因此一般是将它放入HTTP请求的Header Authorization字段中。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Authorization: Bearer</span><br></pre></td></tr></table></figure>

<p>当跨域时，也可以将JWT被放置于POST请求的数据主体中。</p>
<h1 id="5-JWT问题和趋势"><a href="#5-JWT问题和趋势" class="headerlink" title="5. JWT问题和趋势"></a>5. JWT问题和趋势</h1><p>1、JWT默认不加密，但可以加密。生成原始令牌后，可以使用改令牌再次对其进行加密。</p>
<p>2、当JWT未加密方法是，一些私密数据无法通过JWT传输。</p>
<p>3、JWT不仅可用于认证，还可用于信息交换。善用JWT有助于减少服务器请求数据库的次数。</p>
<p>4、JWT的最大缺点是服务器不保存会话状态，所以在使用期间不可能取消令牌或更改令牌的权限。也就是说，一旦JWT签发，在有效期内将会一直有效。</p>
<p>5、JWT本身包含认证信息，因此一旦信息泄露，任何人都可以获得令牌的所有权限。为了减少盗用，JWT的有效期不宜设置太长。对于某些重要操作，用户在使用时应该每次都进行进行身份验证。</p>
<p>6、为了减少盗用和窃取，JWT不建议使用HTTP协议来传输代码，而是使用加密的HTTPS协议进行传输。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://swiftist.cn/2018/12/29/webstorm/%E5%9C%A8IDEA%E9%87%8Cgradle%E9%85%8D%E7%BD%AE%E5%92%8C%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Andy Ge">
      <meta itemprop="description" content="勇于积极进取，步入人生的世外桃源">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="飞雪轩辕">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/12/29/webstorm/%E5%9C%A8IDEA%E9%87%8Cgradle%E9%85%8D%E7%BD%AE%E5%92%8C%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">在IDEA里gradle配置和使用</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-12-29 09:19:58" itemprop="dateCreated datePublished" datetime="2018-12-29T09:19:58+08:00">2018-12-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-03-31 23:07:39" itemprop="dateModified" datetime="2020-03-31T23:07:39+08:00">2020-03-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/gradle/" itemprop="url" rel="index">
                    <span itemprop="name">gradle</span>
                  </a>
                </span>
            </span>

          
            <span id="/2018/12/29/webstorm/%E5%9C%A8IDEA%E9%87%8Cgradle%E9%85%8D%E7%BD%AE%E5%92%8C%E4%BD%BF%E7%94%A8/" class="post-meta-item leancloud_visitors" data-flag-title="在IDEA里gradle配置和使用" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>有人说Gradle使用groovy语言编写，简单，明了没像maven使用xml臃肿，其实我倒不觉得，我觉得maven挺好的，管理jar依赖和项目生命周期挺方便的，我使用gradle只是因为公司用，不然我估计不会学习gradle。下面是gradle的优点，自己斟酌吧。</p>
<ol>
<li>按约定声明构建和建设；</li>
<li>强大的支持多工程的构建；</li>
<li>强大的依赖管理（基于Apache Ivy），提供最大的便利去构建工程；</li>
<li>全力支持已有的 Maven 或者Ivy仓库基础建设；</li>
<li>支持传递性依赖管理，在不需要远程仓库和pom.xml和ivy配置文件的前提下；  </li>
<li>基于groovy脚本构建，其build脚本使用groovy语言编写；</li>
<li>具有广泛的领域模型支持构建；</li>
<li>深度 API；</li>
<li>易迁移；</li>
<li>自由和开放源码，Gradle是一个开源项目，基于 ASL 许可。</li>
</ol>
<hr>
<h1 id="Windows环境IDEA配置gradle"><a href="#Windows环境IDEA配置gradle" class="headerlink" title="Windows环境IDEA配置gradle"></a>Windows环境IDEA配置gradle</h1><h2 id="配置系统环境变量"><a href="#配置系统环境变量" class="headerlink" title="配置系统环境变量"></a>配置系统环境变量</h2><p>为了使用gradle命令，idea里使用不了命令。比如编译命令<code>gradle build</code></p>
<h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><p><a href="https://gradle.org/releases/" target="_blank" rel="noopener">gradle安装包下载地址</a>,解压到“<code>D:\soft\gradle\gradle-4.8</code>”</p>
<h2 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h2><p>打开环境配置，新建系统环境“GRADLE_HOME”,值为<code>D:\soft\gradle\gradle-4.8</code>,找到path变量，后面添加<code>%GRADLE_HOME%\bin;</code>。</p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>在cmd命令里输入<code>gradle -v</code>如果能打出版本号，说明环境配置完毕。</p>
<h2 id="idea配置"><a href="#idea配置" class="headerlink" title="idea配置"></a>idea配置</h2><p>在D盘新建文件<code>.gradle</code>（使用dos命令<code>mkdir .gradle</code> ）,做为gradle下载的jar包仓库主目录，默认在<code>C:\Users\Administrator\.gradle</code>.<br>打开file-&gt;setting-&gt;Build,Execution,Deployment-&gt;Gradle，修改如下：<br><img src="/images/owl/idea_gradle.png" alt="这里写图片描述"><br><code>Gradle home</code>指定了gradle文件目录<br><code>Service directory path</code>指定了gradle工作主目录  </p>
<hr>
<h1 id="gradle仓库设置"><a href="#gradle仓库设置" class="headerlink" title="gradle仓库设置"></a>gradle仓库设置</h1><p>建议如下设置</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">repositories</span> &#123;</span><br><span class="line">    mavenLocal()</span><br><span class="line">    maven &#123; url <span class="string">"http://maven.aliyun.com/nexus/content/groups/public/"</span>&#125;</span><br><span class="line">    mavenCentral()</span><br><span class="line">    jcenter()</span><br><span class="line">    maven &#123; url <span class="string">"https://repo.spring.io/snapshot"</span> &#125;</span><br><span class="line">    maven &#123; url <span class="string">"https://repo.spring.io/milestone"</span> &#125;</span><br><span class="line">    maven &#123; url <span class="string">'http://oss.jfrog.org/artifactory/oss-snapshot-local/'</span> &#125;  <span class="comment">//转换pdf使用</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>存储库只是文件的集合，按分组，名称和版本来组织构造。 默认情况下，Gradle不定义任何存储库。 这里使用repositories 指定存储库。<br>mavenLocal()：指定使用maven本地仓库，而本地仓库在配置maven时setting文件指定的仓库位置。如<code>&lt;localRepository&gt;D:/repository&lt;/localRepository&gt;</code>，同时将<code>setting</code>文件拷贝到<code>C:\Users\Administrator\.m2</code>目录下，一般该目录下是没有<code>setting</code>文件的，gradle查找jar包顺序如下：<code>gradle默认会按以下顺序去查找本地的仓库：USER_HOME/.m2/settings.xml &gt;&gt; M2_HOME/conf/settings.xml &gt;&gt; USER_HOME/.m2/repository。</code><br><code>maven { url &quot;http://maven.aliyun.com/nexus/content/groups/public/&quot;}</code>：指定阿里云镜像加速地址<br>mavenCentral()：这是Maven的中央仓库，无需配置，直接声明就可以使用<br>jcenter():JCenter中央仓库，实际也是是用的maven搭建的，但相比Maven仓库更友好，通过CDN分发，并且支持https访问。<br>后面的<code>maven { url 地址}</code>，指定maven仓库，一般用私有仓库地址或其它的第三方库<br>gradle按配置顺序寻找jar文件。如果本地存在就不会再去下载。不存在的再去maven仓库下载，这里注意下载下来的jar文件不在maven仓库里，而是在gradle的主工作目录下，如上面的<code>D:\.gradle</code>目录<br>参考<a href="http://www.souvc.com/?p=2573" target="_blank" rel="noopener">《Gradle实战》如何配置利用Maven本地仓库</a></p>
<hr>
<h1 id="构建命令"><a href="#构建命令" class="headerlink" title="构建命令"></a>构建命令</h1><p>清理命令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle clean</span><br></pre></td></tr></table></figure>

<p>构建打包命令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle clean build</span><br></pre></td></tr></table></figure>

<p>编译时跳过测试，使用<code>-x</code>,<code>-x</code>参数用来排除不需要执行的任务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle clean build -x test</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="创建缓存依赖"><a href="#创建缓存依赖" class="headerlink" title="创建缓存依赖"></a>创建缓存依赖</h1><p>执行命令<code>gradle clean build --refresh-dependencies</code>或删除.gradle/caches目录，构建的时候它会下载所有依赖并加入到缓存中。</p>
<hr>
<h1 id="阿里云镜像"><a href="#阿里云镜像" class="headerlink" title="阿里云镜像"></a>阿里云镜像</h1><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        maven &#123; url <span class="string">'http://maven.aliyun.com/nexus/content/groups/public/'</span> &#125;</span><br><span class="line">        maven&#123; url <span class="string">'http://maven.aliyun.com/nexus/content/repositories/jcenter'</span>&#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="参考gradle配置国内镜像"><a href="#参考gradle配置国内镜像" class="headerlink" title="参考gradle配置国内镜像"></a><a href="https://blog.csdn.net/lj402159806/article/details/78422953" target="_blank" rel="noopener">参考gradle配置国内镜像</a></h2><h1 id="gradle-build构建脚本"><a href="#gradle-build构建脚本" class="headerlink" title="gradle.build构建脚本"></a>gradle.build构建脚本</h1><p>build.gradle是Gradle默认的构建脚本文件，执行Gradle命令的时候，会默认加载当前目录下的build.gradle脚本文件。<br>gradle.build脚本如下：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">buildScript &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">         mavenCentral()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">repositories &#123;</span><br><span class="line">     mavenCentral()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>buildScript里的repositories是这个脚本需要的依赖库，与项目无关，在执行脚本时，会从这个库里download对应的jar和插件。第二个repositories是项目里需要依赖的jar的库。</p>
<hr>
<h1 id="查看项目已定义的所有task以及含义"><a href="#查看项目已定义的所有task以及含义" class="headerlink" title="查看项目已定义的所有task以及含义"></a>查看项目已定义的所有task以及含义</h1><p>命令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle tasks</span><br></pre></td></tr></table></figure>

<p>比如结果如下</p>
<ul>
<li>assemble: 编译</li>
<li>build：编译并执行测试</li>
<li>clean：删除build目录</li>
<li>jar： 生成jar包</li>
<li>test：执行单元测试</li>
</ul>
<hr>
<h1 id="maven项目转换为gradle项目"><a href="#maven项目转换为gradle项目" class="headerlink" title="maven项目转换为gradle项目"></a>maven项目转换为gradle项目</h1><p>根目录执行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle init --<span class="built_in">type</span> pom</span><br></pre></td></tr></table></figure>

<p>上面的命令会根据pom文件自动生成gradle项目所需的文件和配置，然后以gradle项目重新导入即可。</p>
<hr>
<h1 id="settings-gradle配置"><a href="#settings-gradle配置" class="headerlink" title="settings.gradle配置"></a>settings.gradle配置</h1><p>是模块Module配置文件，大多数setting.gradle的作用是为了配置子工程，根目录下的settings.gradle脚本文件是针对module的全局配置，它的作用域所包含的所有module是通过settings.gradle来配置。<br>settings.gradle用于创建多Project的Gradle项目。Project在IDEA里对应Module模块。<br>例如配置module名<code>rootProject.name = &#39;DyoonPLM&#39;</code></p>
<p>参考<a href="https://www.jianshu.com/p/001abe1d8e95" target="_blank" rel="noopener">Gradle 入门–只此一篇</a>  </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://swiftist.cn/2018/12/28/myBatis/Mybatis-%E7%B1%BB%E5%B1%9E%E6%80%A7%E5%92%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%97%E6%AE%B5%E6%98%A0%E5%B0%84%E6%96%B9%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Andy Ge">
      <meta itemprop="description" content="勇于积极进取，步入人生的世外桃源">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="飞雪轩辕">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/12/28/myBatis/Mybatis-%E7%B1%BB%E5%B1%9E%E6%80%A7%E5%92%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%97%E6%AE%B5%E6%98%A0%E5%B0%84%E6%96%B9%E5%BC%8F/" class="post-title-link" itemprop="url">Mybatis-类属性和数据库字段映射方式</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-12-28 12:16:47" itemprop="dateCreated datePublished" datetime="2018-12-28T12:16:47+08:00">2018-12-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-03-31 23:07:39" itemprop="dateModified" datetime="2020-03-31T23:07:39+08:00">2020-03-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mybatis/" itemprop="url" rel="index">
                    <span itemprop="name">mybatis</span>
                  </a>
                </span>
            </span>

          
            <span id="/2018/12/28/myBatis/Mybatis-%E7%B1%BB%E5%B1%9E%E6%80%A7%E5%92%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%97%E6%AE%B5%E6%98%A0%E5%B0%84%E6%96%B9%E5%BC%8F/" class="post-meta-item leancloud_visitors" data-flag-title="Mybatis-类属性和数据库字段映射方式" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="通过-XML-映射文件中的-resultMap"><a href="#通过-XML-映射文件中的-resultMap" class="headerlink" title="通过 XML 映射文件中的 resultMap"></a>通过 XML 映射文件中的 resultMap</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"data.UserMapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"data.User"</span> <span class="attr">id</span>=<span class="string">"userResultMap"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 用id属性来映射主键字段 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"user_id"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 用result属性来映射非主键字段 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userName"</span> <span class="attr">column</span>=<span class="string">"user_name"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="通过属性配置完成映射"><a href="#通过属性配置完成映射" class="headerlink" title="通过属性配置完成映射"></a>通过属性配置完成映射</h1><p>使用者最陌生的是通过配置属性来完成映射，Mybatis 给我们提供了一种映射方式，如果属性的命名是遵从驼峰命名法的，数据列名遵从下划线命名，那么可以使用这种方式，类似如下：</p>
<ul>
<li>userName 对应 user_name;</li>
<li>userId 对应 user_id;</li>
</ul>
<h2 id="配置代码如下"><a href="#配置代码如下" class="headerlink" title="配置代码如下"></a>配置代码如下</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SqlSessionFactoryBean sqlSessionFactoryBean = <span class="keyword">new</span> SqlSessionFactoryBean();</span><br><span class="line">Configuration configuration = <span class="keyword">new</span> Configuration();</span><br><span class="line">configuration.setMapUnderscoreToCamelCase(<span class="keyword">true</span>);</span><br><span class="line">sqlSessionFactoryBean.setConfiguration(configuration);</span><br></pre></td></tr></table></figure>

<h2 id="SpringMVC-中配置方式"><a href="#SpringMVC-中配置方式" class="headerlink" title="SpringMVC 中配置方式"></a>SpringMVC 中配置方式</h2><p>在配置文件中添加配置如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"mapUnderscoreToCamelCase"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="SpringBoot-配置方式"><a href="#SpringBoot-配置方式" class="headerlink" title="SpringBoot 配置方式"></a>SpringBoot 配置方式</h2><p>application.yml 中添加配置如下</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">    <span class="attr">configuration:</span></span><br><span class="line">        <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">mapperLocations:</span> <span class="string">mybatis//*Mapper.xml</span></span><br><span class="line">    <span class="attr">typeAliasesPackage:</span> <span class="string">com.lny</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://swiftist.cn/2018/12/28/misc/%E4%B8%80%E4%B8%AA%E5%A5%BD%E7%94%A8%E7%9A%84%E5%8E%8B%E6%B5%8B%E5%B7%A5%E5%85%B7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Andy Ge">
      <meta itemprop="description" content="勇于积极进取，步入人生的世外桃源">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="飞雪轩辕">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/12/28/misc/%E4%B8%80%E4%B8%AA%E5%A5%BD%E7%94%A8%E7%9A%84%E5%8E%8B%E6%B5%8B%E5%B7%A5%E5%85%B7/" class="post-title-link" itemprop="url">一个好用的压测工具</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-12-28 10:01:56" itemprop="dateCreated datePublished" datetime="2018-12-28T10:01:56+08:00">2018-12-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-03-31 23:07:39" itemprop="dateModified" datetime="2020-03-31T23:07:39+08:00">2020-03-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/misc/" itemprop="url" rel="index">
                    <span itemprop="name">misc</span>
                  </a>
                </span>
            </span>

          
            <span id="/2018/12/28/misc/%E4%B8%80%E4%B8%AA%E5%A5%BD%E7%94%A8%E7%9A%84%E5%8E%8B%E6%B5%8B%E5%B7%A5%E5%85%B7/" class="post-meta-item leancloud_visitors" data-flag-title="一个好用的压测工具" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="工具下载"><a href="#工具下载" class="headerlink" title="工具下载"></a>工具下载</h1><p><a href="/images/misc/Apache24.rar">压测工具下载</a></p>
<h1 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h1><p>解压后，转到<code>/bin</code>目录下，在地址栏中输入<code>cmd</code>打开命令终端输入如下命令：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -c 并发数</span></span><br><span class="line"><span class="comment"># -n 总连接数</span></span><br><span class="line">C:\Users\AndyGe\Desktop\Apache24\bin&gt;ab -c 500 -n 10000 http://localhost/index_db.asp</span><br><span class="line">This is ApacheBench, Version 2.3 &lt;<span class="variable">$Revision</span>: 1843412 $&gt;</span><br><span class="line">Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/</span><br><span class="line">Licensed to The Apache Software Foundation, http://www.apache.org/</span><br><span class="line"></span><br><span class="line">Benchmarking localhost (be patient)</span><br><span class="line">Completed 1000 requests</span><br><span class="line">Completed 2000 requests</span><br><span class="line">Completed 3000 requests</span><br><span class="line">Completed 4000 requests</span><br><span class="line">Completed 5000 requests</span><br><span class="line">Completed 6000 requests</span><br><span class="line">Completed 7000 requests</span><br><span class="line">Completed 8000 requests</span><br><span class="line">Completed 9000 requests</span><br><span class="line">Completed 10000 requests</span><br><span class="line">Finished 10000 requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Server Software:        Microsoft-IIS/10.0</span><br><span class="line">Server Hostname:        localhost</span><br><span class="line">Server Port:            80</span><br><span class="line"></span><br><span class="line">Document Path:          /index_db.asp</span><br><span class="line">Document Length:        1937 bytes</span><br><span class="line"></span><br><span class="line">Concurrency Level:      500</span><br><span class="line">Time taken <span class="keyword">for</span> tests:   9.295 seconds</span><br><span class="line">Complete requests:      10000</span><br><span class="line">Failed requests:        0</span><br><span class="line">Total transferred:      22160000 bytes</span><br><span class="line">HTML transferred:       19370000 bytes</span><br><span class="line"><span class="comment"># 有参考意义的指标，每秒连接数</span></span><br><span class="line">Requests per second:    1075.85 [<span class="comment">#/sec] (mean)</span></span><br><span class="line">Time per request:       464.750 [ms] (mean)</span><br><span class="line">Time per request:       0.930 [ms] (mean, across all concurrent requests)</span><br><span class="line">Transfer rate:          2328.20 [Kbytes/sec] received</span><br><span class="line"></span><br><span class="line">Connection Times (ms)</span><br><span class="line">              min  mean[+/-sd] median   max</span><br><span class="line">Connect:        0    0   0.4      0      12</span><br><span class="line">Processing:   176  449  54.6    458     537</span><br><span class="line">Waiting:        4  448  55.5    457     534</span><br><span class="line">Total:        176  449  54.5    458     537</span><br><span class="line"></span><br><span class="line">Percentage of the requests served within a certain time (ms)</span><br><span class="line">  50%    458</span><br><span class="line">  66%    467</span><br><span class="line">  75%    471</span><br><span class="line">  80%    474</span><br><span class="line">  90%    490</span><br><span class="line">  95%    501</span><br><span class="line">  98%    508</span><br><span class="line">  99%    512</span><br><span class="line"> 100%    537 (longest request)</span><br></pre></td></tr></table></figure>

<p>其中的<code>Requests per second</code>是比较有意义的指标，即每秒连接数。</p>
<h1 id="sql-链接追踪"><a href="#sql-链接追踪" class="headerlink" title="sql 链接追踪"></a>sql 链接追踪</h1><p>打开<code>Sql Server Profile</code>，新创建一个<code>跟踪</code>，只选择一个<code>Audit Login</code>事件即可，这样可以跟踪实际的数据库链接数。<br><img src="/images/misc/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20181228101227.png" alt="配置截图"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://swiftist.cn/2018/12/27/SpringJPA/Spring-Data-JPA-%E5%AE%9E%E7%8E%B0%E5%A4%9A%E8%A1%A8%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Andy Ge">
      <meta itemprop="description" content="勇于积极进取，步入人生的世外桃源">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="飞雪轩辕">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/12/27/SpringJPA/Spring-Data-JPA-%E5%AE%9E%E7%8E%B0%E5%A4%9A%E8%A1%A8%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2/" class="post-title-link" itemprop="url">Spring Data JPA 实现多表关联查询</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-12-27 08:26:52" itemprop="dateCreated datePublished" datetime="2018-12-27T08:26:52+08:00">2018-12-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-03-31 23:07:39" itemprop="dateModified" datetime="2020-03-31T23:07:39+08:00">2020-03-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/jpa/" itemprop="url" rel="index">
                    <span itemprop="name">jpa</span>
                  </a>
                </span>
            </span>

          
            <span id="/2018/12/27/SpringJPA/Spring-Data-JPA-%E5%AE%9E%E7%8E%B0%E5%A4%9A%E8%A1%A8%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2/" class="post-meta-item leancloud_visitors" data-flag-title="Spring Data JPA 实现多表关联查询" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>多表查询在 spring data jpa 中有两种实现方式，第一种是利用 hibernate 的级联查询来实现，第二种是创建一个结果集的接口来接收连表查询后的结果，这里介绍第二种方式。</p>
<h1 id="一、一对一映射"><a href="#一、一对一映射" class="headerlink" title="一、一对一映射"></a>一、一对一映射</h1><p>实体 UserInfo ：用户。</p>
<p>实体 Address：家庭住址。</p>
<p>这里通过外键的方式(一个实体通过外键关联到另一个实体的主键)来实现一对一关联。</p>
<h2 id="实体类"><a href="#实体类" class="headerlink" title="实体类"></a>实体类</h2><h2 id="1、实体类-UserInfo-java"><a href="#1、实体类-UserInfo-java" class="headerlink" title="1、实体类 UserInfo.java"></a>1、实体类 UserInfo.java</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.johnfnash.learn.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GenerationType;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Table;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name=<span class="string">"tb_user"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">8283950216116626180L</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">  <span class="meta">@GeneratedValue</span>(strategy=GenerationType.IDENTITY)</span><br><span class="line">  <span class="keyword">private</span> Long userId;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">  <span class="keyword">private</span> String sex;</span><br><span class="line">  <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 与 Address 的关联</span></span><br><span class="line">  <span class="keyword">private</span> Long addressId;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">UserInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">UserInfo</span><span class="params">(String name, <span class="keyword">int</span> age, String sex, String email, Long addressId)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.age = age;</span><br><span class="line">    <span class="keyword">this</span>.sex = sex;</span><br><span class="line">    <span class="keyword">this</span>.email = email;</span><br><span class="line">    <span class="keyword">this</span>.addressId = addressId;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// getter, setter</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> String.format(<span class="string">"UserInfo [userId=%d, name=%s, age=%s, sex=%s, email=%s]"</span>, userId, name, age, sex, email);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-实体类-Address-java"><a href="#2-实体类-Address-java" class="headerlink" title="2. 实体类 Address.java"></a>2. 实体类 Address.java</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.johnfnash.learn.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GenerationType;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Table;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"tb_address"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Address</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">  <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">  <span class="keyword">private</span> Long addressId;</span><br><span class="line">  <span class="keyword">private</span> String areaCode;</span><br><span class="line">  <span class="keyword">private</span> String country;</span><br><span class="line">  <span class="keyword">private</span> String province;</span><br><span class="line">  <span class="keyword">private</span> String city;</span><br><span class="line">  <span class="keyword">private</span> String area;</span><br><span class="line">  <span class="keyword">private</span> String detailAddress;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Address</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Address</span><span class="params">(String areaCode, String country, String province, String city, String area,</span></span></span><br><span class="line"><span class="function"><span class="params">      String detailAddress)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">    <span class="keyword">this</span>.areaCode = areaCode;</span><br><span class="line">    <span class="keyword">this</span>.country = country;</span><br><span class="line">    <span class="keyword">this</span>.province = province;</span><br><span class="line">    <span class="keyword">this</span>.city = city;</span><br><span class="line">    <span class="keyword">this</span>.area = area;</span><br><span class="line">    <span class="keyword">this</span>.detailAddress = detailAddress;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// getter, setter</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Address [addressId="</span> + addressId + <span class="string">", areaCode="</span> + areaCode + <span class="string">", country="</span> + country + <span class="string">", province="</span></span><br><span class="line">        + province + <span class="string">", city="</span> + city + <span class="string">", area="</span> + area + <span class="string">", detailAddress="</span> + detailAddress + <span class="string">"]"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Dao-层"><a href="#Dao-层" class="headerlink" title="Dao 层"></a>Dao 层</h2><h2 id="1、UserInfoRepository-java"><a href="#1、UserInfoRepository-java" class="headerlink" title="1、UserInfoRepository.java"></a>1、UserInfoRepository.java</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.johnfnash.learn.repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.Query;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.johnfnash.learn.domain.UserInfo;</span><br><span class="line"><span class="keyword">import</span> com.johnfnash.learn.domain.ViewInfo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserInfoRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">UserInfo</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Query</span>(value = <span class="string">"SELECT new com.johnfnash.learn.domain.ViewInfo(u, a) FROM UserInfo u, Address a WHERE u.addressId = a.addressId"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> List&lt;ViewInfo&gt; <span class="title">findViewInfo</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注：这里的 ViewInfo 类用来一个用来接收多表查询结果集的类（使用 new + 完整类名构造函数）<br>代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.johnfnash.learn.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewInfo</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">6347911007178390219L</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> UserInfo userInfo;</span><br><span class="line">  <span class="keyword">private</span> Address address;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ViewInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ViewInfo</span><span class="params">(UserInfo userInfo)</span> </span>&#123;</span><br><span class="line">    Address address = <span class="keyword">new</span> Address();</span><br><span class="line">    <span class="keyword">this</span>.userInfo = userInfo;</span><br><span class="line">    <span class="keyword">this</span>.address = address;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ViewInfo</span><span class="params">(Address address)</span> </span>&#123;</span><br><span class="line">    UserInfo userInfo = <span class="keyword">new</span> UserInfo();</span><br><span class="line">    <span class="keyword">this</span>.userInfo = userInfo;</span><br><span class="line">    <span class="keyword">this</span>.address = address;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ViewInfo</span><span class="params">(UserInfo userInfo, Address address)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.userInfo = userInfo;</span><br><span class="line">    <span class="keyword">this</span>.address = address;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// getter, setter</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-AddressRepository-java"><a href="#2-AddressRepository-java" class="headerlink" title="2. AddressRepository.java"></a>2. AddressRepository.java</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.johnfnash.learn.repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.johnfnash.learn.domain.Address;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AddressRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Address</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.johnfnash.learn;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.After;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.johnfnash.learn.domain.Address;</span><br><span class="line"><span class="keyword">import</span> com.johnfnash.learn.domain.UserInfo;</span><br><span class="line"><span class="keyword">import</span> com.johnfnash.learn.domain.ViewInfo;</span><br><span class="line"><span class="keyword">import</span> com.johnfnash.learn.repository.AddressRepository;</span><br><span class="line"><span class="keyword">import</span> com.johnfnash.learn.repository.UserInfoRepository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">SpringBootTest</span></span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">UserInfoRepositoryTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserInfoRepository userInfoRepository;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> AddressRepository addressRepository;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Address addr1 = <span class="keyword">new</span> Address(<span class="string">"027"</span>,<span class="string">"CN"</span>,<span class="string">"HuBei"</span>, <span class="string">"WuHan"</span>,<span class="string">"WuChang"</span>, <span class="string">"123 street"</span>);</span><br><span class="line">        Address addr2 = <span class="keyword">new</span> Address(<span class="string">"023"</span>,<span class="string">"CN"</span>,<span class="string">"ChongQing"</span>, <span class="string">"ChongQing"</span>,<span class="string">"YuBei"</span>, <span class="string">"123 road"</span>);</span><br><span class="line">        addressRepository.save(addr1);</span><br><span class="line">        addressRepository.save(addr2);</span><br><span class="line"></span><br><span class="line">        UserInfo user1 = <span class="keyword">new</span> UserInfo(<span class="string">"ZS"</span>, <span class="number">21</span>,<span class="string">"Male"</span>,<span class="string">"123@xx.com"</span>, addr1.getAddressId());</span><br><span class="line">        UserInfo user2 = <span class="keyword">new</span> UserInfo(<span class="string">"Ww"</span>, <span class="number">25</span>,<span class="string">"Male"</span>,<span class="string">"234@xx.com"</span>, addr2.getAddressId());</span><br><span class="line">        userInfoRepository.save(user1);</span><br><span class="line">        userInfoRepository.save(user2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@After</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    userInfoRepository.deleteAll();</span><br><span class="line"></span><br><span class="line">    addressRepository.deleteAll();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQuery</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;ViewInfo&gt; viewInfos = userInfoRepository.findViewInfo();</span><br><span class="line">    <span class="keyword">for</span> (ViewInfo viewInfo : viewInfos) &#123;</span><br><span class="line">      System.out.println(viewInfo.getUserInfo());</span><br><span class="line">      System.out.println(viewInfo.getAddress());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>查询相关的 sql 如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Hibernate: <span class="keyword">select</span> userinfo0_.user_id <span class="keyword">as</span> col_0_0_, address1_.address_id <span class="keyword">as</span> col_1_0_ <span class="keyword">from</span> tb_user userinfo0_ <span class="keyword">cross</span> <span class="keyword">join</span> tb_address address1_ <span class="keyword">where</span> userinfo0_.address_id=address1_.address_id</span><br><span class="line">Hibernate: <span class="keyword">select</span> userinfo0_.user_id <span class="keyword">as</span> user_id1_4_0_, userinfo0_.address_id <span class="keyword">as</span> address_2_4_0_, userinfo0_.age <span class="keyword">as</span> age3_4_0_, userinfo0_.email <span class="keyword">as</span> email4_4_0_, userinfo0_.name <span class="keyword">as</span> name5_4_0_, userinfo0_.sex <span class="keyword">as</span> sex6_4_0_ <span class="keyword">from</span> tb_user userinfo0_ <span class="keyword">where</span> userinfo0_.user_id=?</span><br><span class="line">Hibernate: <span class="keyword">select</span> address0_.address_id <span class="keyword">as</span> address_1_3_0_, address0_.area <span class="keyword">as</span> area2_3_0_, address0_.area_code <span class="keyword">as</span> area_cod3_3_0_, address0_.city <span class="keyword">as</span> city4_3_0_, address0_.country <span class="keyword">as</span> country5_3_0_, address0_.detail_address <span class="keyword">as</span> detail_a6_3_0_, address0_.province <span class="keyword">as</span> province7_3_0_ <span class="keyword">from</span> tb_address address0_ <span class="keyword">where</span> address0_.address_id=?</span><br><span class="line">Hibernate: <span class="keyword">select</span> userinfo0_.user_id <span class="keyword">as</span> user_id1_4_0_, userinfo0_.address_id <span class="keyword">as</span> address_2_4_0_, userinfo0_.age <span class="keyword">as</span> age3_4_0_, userinfo0_.email <span class="keyword">as</span> email4_4_0_, userinfo0_.name <span class="keyword">as</span> name5_4_0_, userinfo0_.sex <span class="keyword">as</span> sex6_4_0_ <span class="keyword">from</span> tb_user userinfo0_ <span class="keyword">where</span> userinfo0_.user_id=?</span><br><span class="line">Hibernate: <span class="keyword">select</span> address0_.address_id <span class="keyword">as</span> address_1_3_0_, address0_.area <span class="keyword">as</span> area2_3_0_, address0_.area_code <span class="keyword">as</span> area_cod3_3_0_, address0_.city <span class="keyword">as</span> city4_3_0_, address0_.country <span class="keyword">as</span> country5_3_0_, address0_.detail_address <span class="keyword">as</span> detail_a6_3_0_, address0_.province <span class="keyword">as</span> province7_3_0_ <span class="keyword">from</span> tb_address address0_ <span class="keyword">where</span> address0_.address_id=?</span><br><span class="line">Hibernate: <span class="keyword">select</span> userinfo0_.user_id <span class="keyword">as</span> user_id1_4_, userinfo0_.address_id <span class="keyword">as</span> address_2_4_, userinfo0_.age <span class="keyword">as</span> age3_4_, userinfo0_.email <span class="keyword">as</span> email4_4_, userinfo0_.name <span class="keyword">as</span> name5_4_, userinfo0_.sex <span class="keyword">as</span> sex6_4_ <span class="keyword">from</span> tb_user userinfo0_</span><br><span class="line">Hibernate: <span class="keyword">select</span> address0_.address_id <span class="keyword">as</span> address_1_3_, address0_.area <span class="keyword">as</span> area2_3_, address0_.area_code <span class="keyword">as</span> area_cod3_3_, address0_.city <span class="keyword">as</span> city4_3_, address0_.country <span class="keyword">as</span> country5_3_, address0_.detail_address <span class="keyword">as</span> detail_a6_3_, address0_.province <span class="keyword">as</span> province7_3_ <span class="keyword">from</span> tb_address address0_</span><br></pre></td></tr></table></figure>

<p>查询结果如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">UserInfo [userId=1, name=ZS, age=21, sex=Male, email=123@xx.com]</span><br><span class="line">Address [addressId=1, areaCode=027, country=CN, province=HuBei, city=WuHan, area=WuChang, detailAddress=123 street]</span><br><span class="line">UserInfo [userId=2, name=Ww, age=25, sex=Male, email=234@xx.com]</span><br><span class="line">Address [addressId=2, areaCode=023, country=CN, province=ChongQing, city=ChongQing, area=YuBei, detailAddress=123 road]</span><br></pre></td></tr></table></figure>

<h1 id="二、多对多映射"><a href="#二、多对多映射" class="headerlink" title="二、多对多映射"></a>二、多对多映射</h1><p>实体 Author ：作者。</p>
<p>实体 Book ：书籍</p>
<p>这里通过关联表的方式来实现多对多关联。</p>
<h2 id="实体类定义"><a href="#实体类定义" class="headerlink" title="实体类定义"></a>实体类定义</h2><h2 id="实体类：Author-java"><a href="#实体类：Author-java" class="headerlink" title="实体类：Author.java"></a>实体类：Author.java</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.johnfnash.learn.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Author</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1227555837798655046L</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Author</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Author</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// getter, setter</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> String.format(<span class="string">"Author [id=%s, name=%s]"</span>, id, name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Book-java-实体类"><a href="#Book-java-实体类" class="headerlink" title="Book.java 实体类"></a>Book.java 实体类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.johnfnash.learn.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">2470510857424220408L</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Book</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Book</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//getter, setter</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> String.format(<span class="string">"Book [id=%s, name=%s]"</span>, id, name);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="实体类-BookAuthor-java"><a href="#实体类-BookAuthor-java" class="headerlink" title="实体类 BookAuthor.java"></a>实体类 BookAuthor.java</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.johnfnash.learn.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.IdClass;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Table;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@IdClass</span>(BookAuthorPK<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">Table</span>(<span class="title">name</span> </span>= <span class="string">"book_author"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookAuthor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">  <span class="keyword">private</span> Integer bookId;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">  <span class="keyword">private</span> Integer authorId;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">BookAuthor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">BookAuthor</span><span class="params">(Integer bookId, Integer authorId)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">    <span class="keyword">this</span>.bookId = bookId;</span><br><span class="line">    <span class="keyword">this</span>.authorId = authorId;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// getter, setter</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注：这里使用 @IdClass 注解指定一个联合主键类来映射实体类的多个属性。这个联合主键类的代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.johnfnash.learn.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookAuthorPK</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">1158141803682305656L</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Integer bookId;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Integer authorId;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Integer <span class="title">getBookId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> bookId;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBookId</span><span class="params">(Integer bookId)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.bookId = bookId;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Integer <span class="title">getAuthorId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> authorId;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAuthorId</span><span class="params">(Integer authorId)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.authorId = authorId;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Dao-层定义"><a href="#Dao-层定义" class="headerlink" title="Dao 层定义"></a>Dao 层定义</h2><h2 id="BookRepository-java"><a href="#BookRepository-java" class="headerlink" title="BookRepository.java"></a>BookRepository.java</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.johnfnash.learn.repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.Query;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.johnfnash.learn.domain.Book;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BookRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Book</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Query</span>(nativeQuery = <span class="keyword">true</span>, value = <span class="string">"SELECT b.id, b.name, GROUP_CONCAT(a.name) as authorName from book b, author a, book_author ba"</span></span><br><span class="line">      + <span class="string">" where b.id = ba.book_id and a.id = ba.author_id and b.name like ?1 group by b.id, b.name"</span>)</span><br><span class="line">    List&lt;Object[]&gt; findByNameContaining(String name);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注：<br>1）这里使用 nativeQuery = true 指定使用原生 SQL 进行查询（个人觉得复杂的查询使用原生 SQL 更好<br>2）这里使用了 mysql 的内置函数 GROUP_CONCAT 进行行转列, HQL 无法直接识别。可能会出现 Caused by: org.hibernate.QueryException: No data type for node: org.hibernate.hql.internal.ast.tree.MethodNode 的错误</p>
<h2 id="JpaRepository-java"><a href="#JpaRepository-java" class="headerlink" title="JpaRepository.java"></a>JpaRepository.java</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.johnfnash.learn.repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.johnfnash.learn.domain.Author;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AuthorRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Author</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="BookAuthorRepository-java"><a href="#BookAuthorRepository-java" class="headerlink" title="BookAuthorRepository.java"></a>BookAuthorRepository.java</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.johnfnash.learn.repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.johnfnash.learn.domain.BookAuthor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BookAuthorRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">BookAuthor</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="测试代码部分"><a href="#测试代码部分" class="headerlink" title="测试代码部分"></a>测试代码部分</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.johnfnash.learn;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.assertEquals;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.After;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.johnfnash.learn.domain.Author;</span><br><span class="line"><span class="keyword">import</span> com.johnfnash.learn.domain.Book;</span><br><span class="line"><span class="keyword">import</span> com.johnfnash.learn.domain.BookAuthor;</span><br><span class="line"><span class="keyword">import</span> com.johnfnash.learn.repository.AuthorRepository;</span><br><span class="line"><span class="keyword">import</span> com.johnfnash.learn.repository.BookAuthorRepository;</span><br><span class="line"><span class="keyword">import</span> com.johnfnash.learn.repository.BookRepository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">SpringBootTest</span></span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">BookRepositoryTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> BookRepository bookRepository;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> AuthorRepository authorRepository;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> BookAuthorRepository bookAuthorRepository;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Before</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      Author lewis = <span class="keyword">new</span> Author(<span class="string">"Lewis"</span>);</span><br><span class="line">      Author mark = <span class="keyword">new</span> Author(<span class="string">"Mark"</span>);</span><br><span class="line">      Author peter = <span class="keyword">new</span> Author(<span class="string">"Peter"</span>);</span><br><span class="line">      authorRepository.save(lewis);</span><br><span class="line">      authorRepository.save(mark);</span><br><span class="line">      authorRepository.save(peter);</span><br><span class="line"></span><br><span class="line">      Book spring = <span class="keyword">new</span> Book(<span class="string">"Spring in Action"</span>);</span><br><span class="line">      Book springboot = <span class="keyword">new</span> Book(<span class="string">"Spring Boot in Action"</span>);</span><br><span class="line">      bookRepository.save(spring);</span><br><span class="line">      bookRepository.save(springboot);</span><br><span class="line"></span><br><span class="line">      bookAuthorRepository.save(<span class="keyword">new</span> BookAuthor(spring.getId(), lewis.getId()));</span><br><span class="line">      bookAuthorRepository.save(<span class="keyword">new</span> BookAuthor(spring.getId(), mark.getId()));</span><br><span class="line">      bookAuthorRepository.save(<span class="keyword">new</span> BookAuthor(springboot.getId(), mark.getId()));</span><br><span class="line">      bookAuthorRepository.save(<span class="keyword">new</span> BookAuthor(springboot.getId(), peter.getId()));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@After</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    bookAuthorRepository.deleteAll();</span><br><span class="line">    bookRepository.deleteAll();</span><br><span class="line">    authorRepository.deleteAll();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assertEquals(bookRepository.findAll().size(), <span class="number">2</span>);</span><br><span class="line">    assertEquals(authorRepository.findAll().size(), <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    List&lt;Object[]&gt; books = bookRepository.findByNameContaining(<span class="string">"Spring%"</span>);</span><br><span class="line">    <span class="keyword">for</span> (Object[] book : books) &#123;</span><br><span class="line">      <span class="keyword">for</span> (Object object : book) &#123;</span><br><span class="line">        System.out.print(object + <span class="string">", "</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行 findAll 方法后，查询的相关 SQL 如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hibernate: SELECT b.id, b.name, GROUP_CONCAT(a.name) as authorName from book b, author a, book_author ba where b.id = ba.book_id and a.id = ba.author_id and b.name like ? group by b.id, b.name</span><br></pre></td></tr></table></figure>

<p>输出的结果如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3652</span>, Spring in Action, Lewis,Mark,</span><br><span class="line"><span class="number">3653</span>, Spring Boot in Action, Mark,Peter,</span><br></pre></td></tr></table></figure>

<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p>(1) <a href="https://img-blog.csdn.net/2018060521004740?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3h4YzE2MDU2Mjk4OTU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" target="_blank" rel="noopener">Spring Data JPA 实现多表关联查询</a></p>
<p>(2) <a href="http://www.ityouknow.com/springboot/2016/08/20/springboot(%E4%BA%94)-spring-data-jpa%E7%9A%84%E4%BD%BF%E7%94%A8.html" target="_blank" rel="noopener">springboot(五): spring data jpa 的使用</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://swiftist.cn/2018/12/26/SpringJPA/jpa%E9%80%89%E6%8B%A9%E9%83%A8%E5%88%86%E5%AD%97%E6%AE%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Andy Ge">
      <meta itemprop="description" content="勇于积极进取，步入人生的世外桃源">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="飞雪轩辕">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/12/26/SpringJPA/jpa%E9%80%89%E6%8B%A9%E9%83%A8%E5%88%86%E5%AD%97%E6%AE%B5/" class="post-title-link" itemprop="url">jpa选择部分字段</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-12-26 10:23:46" itemprop="dateCreated datePublished" datetime="2018-12-26T10:23:46+08:00">2018-12-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-03-31 23:07:39" itemprop="dateModified" datetime="2020-03-31T23:07:39+08:00">2020-03-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/jpa/" itemprop="url" rel="index">
                    <span itemprop="name">jpa</span>
                  </a>
                </span>
            </span>

          
            <span id="/2018/12/26/SpringJPA/jpa%E9%80%89%E6%8B%A9%E9%83%A8%E5%88%86%E5%AD%97%E6%AE%B5/" class="post-meta-item leancloud_visitors" data-flag-title="jpa选择部分字段" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="第一种方法：使用-model-查询时转化"><a href="#第一种方法：使用-model-查询时转化" class="headerlink" title="第一种方法：使用 model 查询时转化"></a>第一种方法：使用 model 查询时转化</h1><p>首先建立一个 model ，写上自己想要查询的字段，然后写上构造函数，这步很重要，因为 spring jpa 转化时会调用这个构造方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyModel</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String gender;</span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyModel</span><span class="params">()</span> </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyModel</span><span class="params">(String userName, String name, String gender, String description)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userName = userName;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.gender = gender;</span><br><span class="line">        <span class="keyword">this</span>.description = description;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在 dao 类中写查询方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Query</span>(value = <span class="string">"select new pers.zhuch.model.MyModel(u.userName, ui.name, ui.gender, ui.description) from UserInfo ui, User u where u.id = ui.userId"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;MyModel&gt; <span class="title">getAllRecord</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>直接在查询语句中 new model 框架底层会调用它，然后返回这个对象（这里我写了完整的类路径，不写的时候它报错说找不到类型什么的）</p>
<p>然后就可以获得只有指定字段的 model 了。然后就把它转成 JSON 格式就 O 了。</p>
<h1 id="第二种方法：在-service-里边转换成-JSON"><a href="#第二种方法：在-service-里边转换成-JSON" class="headerlink" title="第二种方法：在 service 里边转换成 JSON"></a>第二种方法：在 service 里边转换成 JSON</h1><p>原理其实和第一种方法差不多，只是处理结果的方式不太一样，只是这种方法我们就不在 hql 中 new Model 了，直接写查询方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Query</span>(value = <span class="string">"select new map(u.userName, ui.name, ui.gender, ui.description) from UserInfo ui, User u where u.id = ui.userId"</span>)</span><br><span class="line"><span class="keyword">public</span> List&lt;Map&lt;String, Object&gt;&gt; getCustomField();</span><br></pre></td></tr></table></figure>

<p>直接 new m(M)ap，然后返回的结果是这样的</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"0"</span>: <span class="string">"admin"</span>,</span><br><span class="line">        <span class="attr">"1"</span>: <span class="string">"你猜"</span>,</span><br><span class="line">        <span class="attr">"2"</span>: <span class="string">"男"</span>,</span><br><span class="line">        <span class="attr">"3"</span>: <span class="string">"一段描述"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"0"</span>: <span class="string">"abc"</span>,</span><br><span class="line">        <span class="attr">"1"</span>: <span class="string">"你猜人家"</span>,</span><br><span class="line">        <span class="attr">"2"</span>: <span class="string">"女"</span>,</span><br><span class="line">        <span class="attr">"3"</span>: <span class="string">"没事先挂了"</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>注：多表联合查询附加额外字段，亦可使用此方法。例如</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Query</span>(<span class="string">"select new map(u as user,'hello' as ext)  from User u where u.id=?1"</span>)</span><br><span class="line">List&lt;Map&lt;String,Object&gt;&gt; findExtTest(Long id);</span><br><span class="line"></span><br><span class="line"><span class="meta">@Query</span>(value=<span class="string">"select u.*,'hello' as ext from user u where u.id=?1"</span>,nativeQuery = <span class="keyword">true</span>)</span><br><span class="line"><span class="function">List&lt;Object&gt; <span class="title">findExtNativeTest</span><span class="params">(Long id)</span></span>;</span><br><span class="line"></span><br><span class="line">List&lt;Map&lt;String,Object&gt;&gt; rows = userRepository.findExtTest(<span class="number">10001l</span>);</span><br><span class="line"><span class="keyword">for</span>(Map&lt;String,Object&gt; row :rows) &#123;</span><br><span class="line">    User user = (User) row.get(<span class="string">"user"</span>);</span><br><span class="line">    String ext = (String) row.get(<span class="string">"ext"</span>);</span><br><span class="line">    System.out.println(user);</span><br><span class="line">    System.out.println(ext);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">List&lt;Object&gt; objects = userRepository.findExtNativeTest(<span class="number">10001l</span>);</span><br><span class="line"><span class="keyword">for</span>(Object obj :objects) &#123;</span><br><span class="line">    Object[] row = (Object[])obj;</span><br><span class="line">    Long id = ((BigInteger) row[<span class="number">0</span>]).longValue();</span><br><span class="line">    String nickName = (String)row[<span class="number">17</span>]; <span class="comment">//数据库字段顺序</span></span><br><span class="line">    String ext = (String) row[row.length-<span class="number">1</span>];</span><br><span class="line">    System.out.println(id);</span><br><span class="line">    System.out.println(nickName);</span><br><span class="line">    System.out.println(ext);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="第三种方法：select-语句部分字段使用默认值"><a href="#第三种方法：select-语句部分字段使用默认值" class="headerlink" title="第三种方法：select 语句部分字段使用默认值"></a>第三种方法：select 语句部分字段使用默认值</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Query</span>(value = <span class="string">"select u.user_name, ui.name, ui.gender,ui.description,'' as headImg from user_info u where u.id = 1"</span>,nativeQuery=<span class="keyword">true</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getAllRecord</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>参考文章：<a href="https://blog.csdn.net/zhu562002124/article/details/75097682" target="_blank" rel="noopener">https://blog.csdn.net/zhu562002124/article/details/75097682</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://swiftist.cn/2018/12/25/SpringJPA/jpa%E5%88%86%E9%A1%B5%E5%AE%9E%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Andy Ge">
      <meta itemprop="description" content="勇于积极进取，步入人生的世外桃源">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="飞雪轩辕">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/12/25/SpringJPA/jpa%E5%88%86%E9%A1%B5%E5%AE%9E%E7%8E%B0/" class="post-title-link" itemprop="url">jpa分页实现</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-12-25 11:21:44" itemprop="dateCreated datePublished" datetime="2018-12-25T11:21:44+08:00">2018-12-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-03-31 23:07:39" itemprop="dateModified" datetime="2020-03-31T23:07:39+08:00">2020-03-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/jpa/" itemprop="url" rel="index">
                    <span itemprop="name">jpa</span>
                  </a>
                </span>
            </span>

          
            <span id="/2018/12/25/SpringJPA/jpa%E5%88%86%E9%A1%B5%E5%AE%9E%E7%8E%B0/" class="post-meta-item leancloud_visitors" data-flag-title="jpa分页实现" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p><code>jpa</code>的分页是通过<code>Pageable</code>来实现的。</p>
</blockquote>
<h1 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="ShopService-java"><a href="#ShopService-java" class="headerlink" title="ShopService.java"></a>ShopService.java</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Page&lt;Shop&gt; <span class="title">search</span><span class="params">(Integer page, Integer size, String name, String code)</span> </span>&#123;</span><br><span class="line">    page -= <span class="number">1</span>;</span><br><span class="line">    Sort sort = <span class="keyword">new</span> Sort(Sort.Direction.DESC, <span class="string">"id"</span>);</span><br><span class="line">    Pageable pageable = PageRequest.of(page, size, sort);</span><br><span class="line">    Specification&lt;Shop&gt; spec = <span class="keyword">new</span> Specification&lt;Shop&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Predicate <span class="title">toPredicate</span><span class="params">(Root&lt;Shop&gt; root, CriteriaQuery&lt;?&gt; cq, CriteriaBuilder cb)</span> </span>&#123;</span><br><span class="line">            <span class="comment">//定义集合来确定Predicate[] 的长度，因为CriteriaBuilder的or方法需要传入的是断言数组</span></span><br><span class="line">            List&lt;Predicate&gt; predicates = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isNotBlank(name)) &#123;</span><br><span class="line">                <span class="comment">//root.get("name")获取字段名</span></span><br><span class="line">                <span class="comment">//company客户端请求的字段值</span></span><br><span class="line">                <span class="comment">//as(String.class)指定该字段的类型</span></span><br><span class="line">                Predicate predicate = cb.like(root.get("name").as(String.class), "%" + name + "%");</span><br><span class="line">                predicates.add(predicate);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isNotBlank(code)) &#123;</span><br><span class="line">                Predicate predicate = cb.like(root.get("code").as(String.class), "%" + code + "%");</span><br><span class="line">                predicates.add(predicate);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//判断结合中是否有数据</span></span><br><span class="line">            <span class="keyword">if</span> (predicates.size() == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//将集合转化为CriteriaBuilder所需要的Predicate[]</span></span><br><span class="line">            Predicate[] predicateArr = <span class="keyword">new</span> Predicate[predicates.size()];</span><br><span class="line">            predicateArr = predicates.toArray(predicateArr);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> cb.and(predicateArr);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    Page&lt;Shop&gt; results = shopRepository.findAll(spec, pageable);</span><br><span class="line">    <span class="keyword">return</span> results;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="ShopController-java"><a href="#ShopController-java" class="headerlink" title="ShopController.java"></a>ShopController.java</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/all"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">search</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        @RequestParam(defaultValue = <span class="string">"1"</span>)</span> Integer page,</span></span><br><span class="line"><span class="function">        @<span class="title">RequestParam</span><span class="params">(defaultValue = <span class="string">"10"</span>)</span> Integer size,</span></span><br><span class="line"><span class="function">        String name, String code) </span>&#123;</span><br><span class="line">    Page&lt;Shop&gt; result = shopService.search(page, size, name, code);</span><br><span class="line">    Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    List&lt;Shop&gt; shops = result.getContent();</span><br><span class="line">    Long count = result.getTotalElements();</span><br><span class="line">    map.put(<span class="string">"shops"</span>, shops);</span><br><span class="line">    map.put(<span class="string">"count"</span>, count);</span><br><span class="line">    <span class="keyword">return</span> map;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="分页组件"><a href="#分页组件" class="headerlink" title="分页组件"></a>分页组件</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-pagination</span></span></span><br><span class="line"><span class="tag">    <span class="attr">background</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:page-size</span>=<span class="string">"pageSize"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:current-page</span>=<span class="string">"currentPage"</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">current-change</span>=<span class="string">"currentChange"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">layout</span>=<span class="string">"prev, pager, next"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:total</span>=<span class="string">"totalCount"</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-pagination</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="js-代码"><a href="#js-代码" class="headerlink" title="js 代码"></a>js 代码</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">currentChange(currentChange) &#123;</span><br><span class="line">  <span class="keyword">this</span>.currentPage = currentChange</span><br><span class="line">  <span class="keyword">this</span>.loadShops()</span><br><span class="line">&#125;,</span><br><span class="line">loadShops() &#123;</span><br><span class="line">  <span class="keyword">const</span> _this = <span class="keyword">this</span></span><br><span class="line">  <span class="keyword">this</span>.tableLoading = <span class="literal">true</span></span><br><span class="line">  <span class="keyword">const</span> &#123;name, code, manager, phone, open, scope,&#125; = <span class="keyword">this</span>.filter</span><br><span class="line">  <span class="keyword">const</span> rd = <span class="keyword">this</span>.filter.regionData</span><br><span class="line">  <span class="keyword">const</span> province = rd.province &amp;&amp; rd.province.value || <span class="string">''</span></span><br><span class="line">  <span class="keyword">const</span> city = rd.city &amp;&amp; rd.city.value || <span class="string">''</span></span><br><span class="line">  <span class="keyword">const</span> area = rd.area &amp;&amp; rd.area.value || <span class="string">''</span></span><br><span class="line">  <span class="keyword">const</span> town = rd.town &amp;&amp; rd.town.value || <span class="string">''</span></span><br><span class="line">  <span class="keyword">const</span> url = <span class="string">`shop/all?page=<span class="subst">$&#123;<span class="keyword">this</span>.currentPage&#125;</span>&amp;size=<span class="subst">$&#123;<span class="keyword">this</span>.pageSize&#125;</span>&amp;name=<span class="subst">$&#123;name&#125;</span>&amp;code=<span class="subst">$&#123;code&#125;</span>`</span></span><br><span class="line">  <span class="keyword">this</span>.getRequest(url).then(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.tableLoading = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (resp &amp;&amp; resp.status == <span class="number">200</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> data = resp.data;</span><br><span class="line">      _this.shops = data.shops</span><br><span class="line">      _this.totalCount = data.count</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://swiftist.cn/2018/12/25/myBatis/mybatis%E5%88%86%E9%A1%B5%E5%AE%9E%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Andy Ge">
      <meta itemprop="description" content="勇于积极进取，步入人生的世外桃源">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="飞雪轩辕">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/12/25/myBatis/mybatis%E5%88%86%E9%A1%B5%E5%AE%9E%E7%8E%B0/" class="post-title-link" itemprop="url">mybatis分页实现</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-12-25 11:08:49" itemprop="dateCreated datePublished" datetime="2018-12-25T11:08:49+08:00">2018-12-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-03-31 23:07:39" itemprop="dateModified" datetime="2020-03-31T23:07:39+08:00">2020-03-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mybatis/" itemprop="url" rel="index">
                    <span itemprop="name">mybatis</span>
                  </a>
                </span>
            </span>

          
            <span id="/2018/12/25/myBatis/mybatis%E5%88%86%E9%A1%B5%E5%AE%9E%E7%8E%B0/" class="post-meta-item leancloud_visitors" data-flag-title="mybatis分页实现" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>在<code>mybatis</code>中实现分页采用 pagehelper 非常容易实现。</p>
</blockquote>
<h1 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--分页支持--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h1><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#pagehelper</span></span><br><span class="line"><span class="attr">pagehelper:</span></span><br><span class="line">    <span class="attr">helperDialect:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">reasonable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">supportMethodsArguments:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">params:</span> <span class="string">count=countSql</span></span><br><span class="line">    <span class="attr">returnPageInfo:</span> <span class="string">check</span></span><br></pre></td></tr></table></figure>

<h1 id="UserMapper-xml"><a href="#UserMapper-xml" class="headerlink" title="UserMapper.xml"></a>UserMapper.xml</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectUsers"</span> <span class="attr">resultMap</span>=<span class="string">"UserManageMap"</span>&gt;</span></span><br><span class="line">    select u.id,u.name,username,avatar,email,mobile,wei_xin,enabled,remark,u.created_at</span><br><span class="line">    ,r.id as role_id, r.name as role_name,r.name_zh as role_name_zh</span><br><span class="line">    from user u</span><br><span class="line">    left join role_user ru on ru.user_id = u.id</span><br><span class="line">    left join role r on r.id = ru.role_id</span><br><span class="line">    where u.username like concat('%',#&#123;keywords&#125;,'%')</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="UserMapper-java"><a href="#UserMapper-java" class="headerlink" title="UserMapper.java"></a>UserMapper.java</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;User2&gt; <span class="title">selectUsers</span><span class="params">(String keywords)</span></span>;</span><br></pre></td></tr></table></figure>

<h1 id="UserService-java"><a href="#UserService-java" class="headerlink" title="UserService.java"></a>UserService.java</h1><p>注意其中的 PageInfo 中自动包含了所有条目总数，可用于客户端的分页。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 这个方法中用到了我们开头配置依赖的分页插件pagehelper</span></span><br><span class="line"><span class="comment"> * 很简单，只需要在service层传入参数，然后将参数传递给一个插件的一个静态方法即可；</span></span><br><span class="line"><span class="comment"> * pageNum 开始页数</span></span><br><span class="line"><span class="comment"> * pageSize 每页显示的数据条数</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PageInfo&lt;User2&gt; <span class="title">findAllUser</span><span class="params">(<span class="keyword">int</span> pageNum, <span class="keyword">int</span> pageSize, String keywords)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//将参数传给这个方法就可以实现物理分页了，非常简单。</span></span><br><span class="line">    PageHelper.startPage(pageNum, pageSize);</span><br><span class="line">    List&lt;User2&gt; userDomains = userMapper.selectUsers(keywords);</span><br><span class="line">    PageInfo result = <span class="keyword">new</span> PageInfo(userDomains);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="UserController-java"><a href="#UserController-java" class="headerlink" title="UserController.java"></a>UserController.java</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/all"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">findAllUser</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        @RequestParam(name = <span class="string">"pageNum"</span>, required = <span class="keyword">false</span>, defaultValue = <span class="string">"1"</span>)</span> <span class="keyword">int</span> pageNum,</span></span><br><span class="line"><span class="function">        @<span class="title">RequestParam</span><span class="params">(name = <span class="string">"pageSize"</span>, required = <span class="keyword">false</span>, defaultValue = <span class="string">"10"</span>)</span> <span class="keyword">int</span> pageSize,</span></span><br><span class="line"><span class="function">        @<span class="title">RequestParam</span><span class="params">(name = <span class="string">"keywords"</span>, required = <span class="keyword">false</span>, defaultValue = <span class="string">""</span>)</span> String keywords</span></span><br><span class="line"><span class="function">) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> userService.findAllUser(pageNum, pageSize,keywords);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="分页组件"><a href="#分页组件" class="headerlink" title="分页组件"></a>分页组件</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-pagination</span></span></span><br><span class="line"><span class="tag">    <span class="attr">style</span>=<span class="string">"width:100%;"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">background</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:page-size</span>=<span class="string">"pageSize"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:current-page</span>=<span class="string">"currentPage"</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">current-change</span>=<span class="string">"currentChange"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">layout</span>=<span class="string">"prev, pager, next"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:total</span>=<span class="string">"totalCount"</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-pagination</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="js-方法"><a href="#js-方法" class="headerlink" title="js 方法"></a>js 方法</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">currentChange(currentChange) &#123;</span><br><span class="line">  <span class="keyword">this</span>.currentPage = currentChange</span><br><span class="line">  <span class="keyword">this</span>.initCards()</span><br><span class="line">&#125;,</span><br><span class="line">initCards() &#123;</span><br><span class="line">  <span class="keyword">this</span>.loading = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">var</span> _this = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">this</span>.getRequest(<span class="string">`/user/all?keywords=<span class="subst">$&#123;<span class="keyword">this</span>.keywords&#125;</span>&amp;pageNum=<span class="subst">$&#123;<span class="keyword">this</span>.currentPage&#125;</span>&amp;pageSize=<span class="subst">$&#123;<span class="keyword">this</span>.pageSize&#125;</span>`</span>).then(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (resp &amp;&amp; resp.status == <span class="number">200</span>) &#123;</span><br><span class="line">      _this.loading = <span class="literal">false</span></span><br><span class="line">      _this.users = resp.data.list</span><br><span class="line">      _this.totalCount = resp.data.total</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h1 id="存在的问题"><a href="#存在的问题" class="headerlink" title="存在的问题"></a>存在的问题</h1><p>上述分页方法返回的总条数是不正确的，因为 PageHelper 会执行<code>select count(0)</code>在原来的结果集上，导致条数会变多，解决的办法是<code>collection</code>采用<code>select</code>单独查询的方式，但是这对性能会有一定的影响。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"UserManageMap"</span> <span class="attr">type</span>=<span class="string">"User2"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"username"</span> <span class="attr">property</span>=<span class="string">"username"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"avatar"</span> <span class="attr">property</span>=<span class="string">"avatar"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"email"</span> <span class="attr">property</span>=<span class="string">"email"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"mobile"</span> <span class="attr">property</span>=<span class="string">"mobile"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"wei_xin"</span> <span class="attr">property</span>=<span class="string">"weiXin"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"enabled"</span> <span class="attr">property</span>=<span class="string">"enabled"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"remark"</span> <span class="attr">property</span>=<span class="string">"remark"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"created_at"</span> <span class="attr">property</span>=<span class="string">"createdAt"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"roles"</span> <span class="attr">ofType</span>=<span class="string">"Role2"</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">select</span>=<span class="string">"com.owl.mapper.UserMapper.getRolesByUserId"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getRolesByUserId"</span> <span class="attr">resultType</span>=<span class="string">"Role2"</span>&gt;</span></span><br><span class="line">    SELECT r.* FROM role_user ru,role r where ru.role_id=r.id AND ru.user_id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectUsers"</span> <span class="attr">resultMap</span>=<span class="string">"UserManageMap"</span>&gt;</span></span><br><span class="line">    select u.id,u.name,username,avatar,email,mobile,wei_xin,enabled,remark,u.created_at</span><br><span class="line">    from user u</span><br><span class="line">    where u.username like concat('%',#&#123;keywords&#125;,'%')</span><br><span class="line">    order by u.id desc</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://swiftist.cn/2018/12/25/vue/vue%E5%9B%BE%E6%A0%87%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Andy Ge">
      <meta itemprop="description" content="勇于积极进取，步入人生的世外桃源">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="飞雪轩辕">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/12/25/vue/vue%E5%9B%BE%E6%A0%87%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">vue图标使用</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-12-25 09:33:15" itemprop="dateCreated datePublished" datetime="2018-12-25T09:33:15+08:00">2018-12-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-03-31 23:07:39" itemprop="dateModified" datetime="2020-03-31T23:07:39+08:00">2020-03-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/vue/" itemprop="url" rel="index">
                    <span itemprop="name">vue</span>
                  </a>
                </span>
            </span>

          
            <span id="/2018/12/25/vue/vue%E5%9B%BE%E6%A0%87%E4%BD%BF%E7%94%A8/" class="post-meta-item leancloud_visitors" data-flag-title="vue图标使用" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-小计"><a href="#1-小计" class="headerlink" title="1. 小计"></a>1. 小计</h1><h2 id="1-1-图标来源"><a href="#1-1-图标来源" class="headerlink" title="1.1. 图标来源"></a>1.1. 图标来源</h2><h3 id="1-1-1-vue内置icon"><a href="#1-1-1-vue内置icon" class="headerlink" title="1.1.1. vue内置icon"></a>1.1.1. vue内置icon</h3><p><a href="http://element-cn.eleme.io/#/zh-CN/component/icon" target="_blank" rel="noopener">http://element-cn.eleme.io/#/zh-CN/component/icon</a></p>
<p>使用方式非常简单，只需要指定类名即可：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"el-icon-edit"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"el-icon-share"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"el-icon-delete"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">"primary"</span> <span class="attr">icon</span>=<span class="string">"el-icon-search"</span>&gt;</span>搜索<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="1-1-2-使用fontawesome"><a href="#1-1-2-使用fontawesome" class="headerlink" title="1.1.2. 使用fontawesome"></a>1.1.2. 使用fontawesome</h3><p><a href="http://www.runoob.com/font-awesome/fontawesome-reference.html" target="_blank" rel="noopener">http://www.runoob.com/font-awesome/fontawesome-reference.html</a></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-bell-o"</span> @<span class="attr">click</span>=<span class="string">"goChat"</span> <span class="attr">style</span>=<span class="string">"cursor: pointer"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">i</span> <span class="attr">v-if</span>=<span class="string">"user.avatar != ''"</span> <span class="attr">class</span>=<span class="string">"fa fa-user-circle"</span> <span class="attr">style</span>=<span class="string">"font-size: 34px;margin:0 10px;"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="1-2-使用"><a href="#1-2-使用" class="headerlink" title="1.2. 使用"></a>1.2. 使用</h2><h3 id="1-2-1-使用内置icon"><a href="#1-2-1-使用内置icon" class="headerlink" title="1.2.1. 使用内置icon"></a>1.2.1. 使用内置icon</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-input</span> <span class="attr">prefix-icon</span>=<span class="string">"el-icon-edit"</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">placeholder</span>=<span class="string">"请输入用户登录名"</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">clearable</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">v-model</span>=<span class="string">"user.username"</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">style</span>=<span class="string">"width:200px;"</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">size</span>=<span class="string">"mini"</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"el-icon-edit"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="1-2-2-fontawesome"><a href="#1-2-2-fontawesome" class="headerlink" title="1.2.2. fontawesome"></a>1.2.2. fontawesome</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-input</span> <span class="attr">prefix-icon</span>=<span class="string">"fa fa-lock"</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">placeholder</span>=<span class="string">"请输入初始密码"</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">clearable</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">v-model</span>=<span class="string">"user.password"</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">style</span>=<span class="string">"width:150px;"</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">size</span>=<span class="string">"mini"</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-bell-o"</span> @<span class="attr">click</span>=<span class="string">"goChat"</span> <span class="attr">style</span>=<span class="string">"cursor: pointer"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/51/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/51/">51</a><span class="page-number current">52</span><a class="page-number" href="/page/53/">53</a><span class="space">&hellip;</span><a class="page-number" href="/page/73/">73</a><a class="extend next" rel="next" href="/page/53/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Andy Ge</p>
  <div class="site-description" itemprop="description">勇于积极进取，步入人生的世外桃源</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">728</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">134</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">315</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/andyge" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;andyge" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:geshaofei@126.com" title="E-Mail → mailto:geshaofei@126.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-link"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://www.ruanyifeng.com/" title="http:&#x2F;&#x2F;www.ruanyifeng.com&#x2F;" rel="noopener" target="_blank">阮一峰</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://colobu.com/" title="http:&#x2F;&#x2F;colobu.com&#x2F;" rel="noopener" target="_blank">鸟窝</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.cnblogs.com/hellokuangshen/" title="https:&#x2F;&#x2F;www.cnblogs.com&#x2F;hellokuangshen&#x2F;" rel="noopener" target="_blank">狂神</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://yelog.org/" title="https:&#x2F;&#x2F;yelog.org&#x2F;" rel="noopener" target="_blank">叶落阁</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Andy Ge</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.7.1
  </div>

        






  <script>
  function leancloudSelector(url) {
    url = encodeURI(url);
    return document.getElementById(url).querySelector('.leancloud-visitors-count');
  }
  if (CONFIG.page.isPost) {
    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.getAttribute('id'));
      var title = visitors.getAttribute('data-flag-title');

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .then(response => response.json())
              .then(() => {
                leancloudSelector(url).innerText = counter.time + 1;
              })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              })
          } else {
              Counter('post', '/classes/Counter', { title: title, url: url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.error('Failed to create', error);
                });
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }
  } else {
    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.getAttribute('id'));
      });

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url: { '$in': entries } })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length === 0) {
            document.querySelectorAll('.leancloud_visitors .leancloud-visitors-count').forEach(element => {
              element.innerText = 0;
            });
            return;
          }
          for (let item of results) {
            let { url, time } = item;
            leancloudSelector(url).innerText = time;
          }
          for (let url of entries) {
            var element = leancloudSelector(url);
            if (element.innerText == '') {
              element.innerText = 0;
            }
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }
  }

  fetch('https://app-router.leancloud.cn/2/route?appId=2TdIb5gRlAVUw24l2W0zWnCj-gzGzoHsz')
    .then(response => response.json())
    .then(({ api_server }) => {
      var Counter = (method, url, data) => {
        return fetch(`https://${api_server}/1.1${url}`, {
          method: method,
          headers: {
            'X-LC-Id'     : '2TdIb5gRlAVUw24l2W0zWnCj-gzGzoHsz',
            'X-LC-Key'    : 'cJdJrMLBXsj0ttq0WsL0aA2j',
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    });
  </script>


      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
