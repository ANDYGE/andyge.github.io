<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"swiftist.cn","root":"/","scheme":"Pisces","version":"7.7.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"appID":"EVBR3H53HW","apiKey":"2abd573a01143a0cc4108fa4d21ae67c","indexName":"swiftist","hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="1、引言本文以设计淘宝网的后台架构为例，介绍从一百个并发到千万级并发情况下服务端的架构的 14 次演进过程，同时列举出每个演进阶段会遇到的相关技术，让大家对架构的演进有一个整体的认知。文章最后汇总了一些架构设计的原则。 （本文同步发布于：http:&#x2F;&#x2F;www.52im.net&#x2F;thread-2665-1-1.html） 2、关于作者 huashiou：广东工业大学计算机科学与技术硕士毕业，大数据开">
<meta property="og:type" content="article">
<meta property="og:title" content="从100到1000万高并发的架构演进之路">
<meta property="og:url" content="https://swiftist.cn/2019/07/18/pig/%E4%BB%8E100%E5%88%B01000%E4%B8%87%E9%AB%98%E5%B9%B6%E5%8F%91%E7%9A%84%E6%9E%B6%E6%9E%84%E6%BC%94%E8%BF%9B%E4%B9%8B%E8%B7%AF/index.html">
<meta property="og:site_name" content="飞雪轩辕">
<meta property="og:description" content="1、引言本文以设计淘宝网的后台架构为例，介绍从一百个并发到千万级并发情况下服务端的架构的 14 次演进过程，同时列举出每个演进阶段会遇到的相关技术，让大家对架构的演进有一个整体的认知。文章最后汇总了一些架构设计的原则。 （本文同步发布于：http:&#x2F;&#x2F;www.52im.net&#x2F;thread-2665-1-1.html） 2、关于作者 huashiou：广东工业大学计算机科学与技术硕士毕业，大数据开">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://swiftist.cn/images/java/arc1.jpeg">
<meta property="og:image" content="https://swiftist.cn/2019/07/18/images/java/arc2.jpeg">
<meta property="og:image" content="https://swiftist.cn/2019/07/18/images/java/arc3.jpeg">
<meta property="og:image" content="https://swiftist.cn/2019/07/18/images/java/arc4.jpeg">
<meta property="og:image" content="https://swiftist.cn/2019/07/18/images/java/arc5.jpeg">
<meta property="og:image" content="https://swiftist.cn/2019/07/18/images/java/arc6.jpeg">
<meta property="og:image" content="https://swiftist.cn/2019/07/18/images/java/arc7.jpeg">
<meta property="og:image" content="https://swiftist.cn/2019/07/18/images/java/arc8.jpeg">
<meta property="og:image" content="https://swiftist.cn/2019/07/18/images/java/arc9.jpeg">
<meta property="og:image" content="https://swiftist.cn/2019/07/18/images/java/arc10.jpeg">
<meta property="og:image" content="https://swiftist.cn/2019/07/18/images/java/arc11.jpeg">
<meta property="og:image" content="https://swiftist.cn/2019/07/18/images/java/arc12.jpeg">
<meta property="og:image" content="https://swiftist.cn/2019/07/18/images/java/arc13.jpeg">
<meta property="og:image" content="https://swiftist.cn/2019/07/18/images/java/arc14.jpeg">
<meta property="og:image" content="https://swiftist.cn/2019/07/18/images/java/arc15.jpeg">
<meta property="og:image" content="https://swiftist.cn/2019/07/18/images/java/arc16.jpeg">
<meta property="article:published_time" content="2019-07-18T07:56:42.000Z">
<meta property="article:modified_time" content="2020-03-31T15:07:39.414Z">
<meta property="article:author" content="Andy Ge">
<meta property="article:tag" content="java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://swiftist.cn/images/java/arc1.jpeg">

<link rel="canonical" href="https://swiftist.cn/2019/07/18/pig/%E4%BB%8E100%E5%88%B01000%E4%B8%87%E9%AB%98%E5%B9%B6%E5%8F%91%E7%9A%84%E6%9E%B6%E6%9E%84%E6%BC%94%E8%BF%9B%E4%B9%8B%E8%B7%AF/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>从100到1000万高并发的架构演进之路 | 飞雪轩辕</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="飞雪轩辕" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">飞雪轩辕</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">人生的乐趣在于把梦想变成现实</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-java">

    <a href="/categories/java/" rel="section"><i class="fa fa-fw fa-th-large"></i>java</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://swiftist.cn/2019/07/18/pig/%E4%BB%8E100%E5%88%B01000%E4%B8%87%E9%AB%98%E5%B9%B6%E5%8F%91%E7%9A%84%E6%9E%B6%E6%9E%84%E6%BC%94%E8%BF%9B%E4%B9%8B%E8%B7%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Andy Ge">
      <meta itemprop="description" content="勇于积极进取，步入人生的世外桃源">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="飞雪轩辕">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          从100到1000万高并发的架构演进之路
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-18 15:56:42" itemprop="dateCreated datePublished" datetime="2019-07-18T15:56:42+08:00">2019-07-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-03-31 23:07:39" itemprop="dateModified" datetime="2020-03-31T23:07:39+08:00">2020-03-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>
            </span>

          
            <span id="/2019/07/18/pig/%E4%BB%8E100%E5%88%B01000%E4%B8%87%E9%AB%98%E5%B9%B6%E5%8F%91%E7%9A%84%E6%9E%B6%E6%9E%84%E6%BC%94%E8%BF%9B%E4%B9%8B%E8%B7%AF/" class="post-meta-item leancloud_visitors" data-flag-title="从100到1000万高并发的架构演进之路" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="1、引言"><a href="#1、引言" class="headerlink" title="1、引言"></a>1、引言</h2><p>本文以设计淘宝网的后台架构为例，介绍从一百个并发到千万级并发情况下服务端的架构的 14 次演进过程，同时列举出每个演进阶段会遇到的相关技术，让大家对架构的演进有一个整体的认知。文章最后汇总了一些架构设计的原则。</p>
<p>（本文同步发布于：<a href="http://www.52im.net/thread-2665-1-1.html）" target="_blank" rel="noopener">http://www.52im.net/thread-2665-1-1.html）</a></p>
<h2 id="2、关于作者"><a href="#2、关于作者" class="headerlink" title="2、关于作者"></a>2、关于作者</h2><p><img src="/images/java/arc1.jpeg" alt="从新手到架构师，一篇就够：从100到1000万高并发的架构演进之路"></p>
<p><strong>huashiou：</strong>广东工业大学计算机科学与技术硕士毕业，大数据开发工程师。在大数据领域具有多年的开发经验，对常用大数据技术都有所了解，在架构设计、高并发、分布式等方面具有一定经验。喜欢学习新技术，乐于分享，欢迎大家关注本博客。</p>
<h2 id="3、相关文章"><a href="#3、相关文章" class="headerlink" title="3、相关文章"></a>3、相关文章</h2><ul>
<li>《<a href="http://www.52im.net/thread-2007-1-1.html" target="_blank" rel="noopener">新手入门：零基础理解大型分布式架构的演进历史、技术原理、最佳实践</a>》</li>
<li>《<a href="http://www.52im.net/thread-1811-1-1.html" target="_blank" rel="noopener">腾讯资深架构师干货总结：一文读懂大型分布式系统设计的方方面面</a>》</li>
<li>《<a href="http://www.52im.net/thread-2494-1-1.html" target="_blank" rel="noopener">一篇读懂分布式架构下的负载均衡技术：分类、原理、算法、常见方案等</a>》</li>
<li>《<a href="http://www.52im.net/thread-1950-1-1.html" target="_blank" rel="noopener">快速理解高性能 HTTP 服务端的负载均衡技术原理</a>》</li>
<li>《<a href="http://www.52im.net/thread-1968-1-1.html" target="_blank" rel="noopener">知乎技术分享：从单机到 2000 万 QPS 并发的 Redis 高性能缓存实践之路</a>》</li>
<li>《<a href="http://www.52im.net/thread-2141-1-1.html" target="_blank" rel="noopener">达达 O2O 后台架构演进实践：从 0 到 4000 高并发请求背后的努力</a>》</li>
<li>《<a href="http://www.52im.net/thread-2323-1-1.html" target="_blank" rel="noopener">小米技术分享：解密小米抢购系统千万高并发架构的演进和实践</a>》</li>
<li>《<a href="http://www.52im.net/thread-2510-1-1.html" target="_blank" rel="noopener">通俗易懂：如何设计能支撑百万并发的数据库架构？</a>》</li>
</ul>
<h2 id="4、基本概念"><a href="#4、基本概念" class="headerlink" title="4、基本概念"></a>4、基本概念</h2><p>在介绍架构之前，为了避免部分读者对架构设计中的一些概念不了解，下面对几个最基础的概念进行介绍。</p>
<p><strong>1）什么是分布式？</strong></p>
<p>系统中的多个模块在不同服务器上部署，即可称为分布式系统，如 Tomcat 和数据库分别部署在不同的服务器上，或两个相同功能的 Tomcat 分别部署在不同服务器上。</p>
<p><strong>2）什么是高可用？</strong></p>
<p>系统中部分节点失效时，其他节点能够接替它继续提供服务，则可认为系统具有高可用性。</p>
<p><strong>3）什么是集群？</strong></p>
<p>一个特定领域的软件部署在多台服务器上并作为一个整体提供一类服务，这个整体称为集群。</p>
<p>如 Zookeeper 中的 Master 和 Slave 分别部署在多台服务器上，共同组成一个整体提供集中配置服务。</p>
<p>在常见的集群中，客户端往往能够连接任意一个节点获得服务，并且当集群中一个节点掉线时，其他节点往往能够自动的接替它继续提供服务，这时候说明集群具有高可用性。</p>
<p><strong>4）什么是负载均衡？</strong></p>
<p>请求发送到系统时，通过某些方式把请求均匀分发到多个节点上，使系统中每个节点能够均匀的处理请求负载，则可认为系统是负载均衡的。</p>
<p><strong>5）什么是正向代理和反向代理？</strong></p>
<p>系统内部要访问外部网络时，统一通过一个代理服务器把请求转发出去，在外部网络看来就是代理服务器发起的访问，此时代理服务器实现的是正向代理；</p>
<p>当外部请求进入系统时，代理服务器把该请求转发到系统中的某台服务器上，对外部请求来说，与之交互的只有代理服务器，此时代理服务器实现的是反向代理。</p>
<p>简单来说，正向代理是代理服务器代替系统内部来访问外部网络的过程，反向代理是外部请求访问系统时通过代理服务器转发到内部服务器的过程。</p>
<a id="more"></a>

<h2 id="5、纯真年代：单机架构"><a href="#5、纯真年代：单机架构" class="headerlink" title="5、纯真年代：单机架构"></a>5、纯真年代：单机架构</h2><p><img src="../../images/java/arc2.jpeg" alt="从新手到架构师，一篇就够：从100到1000万高并发的架构演进之路"></p>
<p>以淘宝作为例子：在网站最初时，应用数量与用户数都较少，可以把 Tomcat 和数据库部署在同一台服务器上。浏览器往 <a href="http://www.taobao.com" target="_blank" rel="noopener">www.taobao.com</a> 发起请求时，首先经过 DNS 服务器（域名系统）把域名转换为实际 IP 地址 10.102.4.1，浏览器转而访问该 IP 对应的 Tomcat。</p>
<p><strong>架构瓶颈：</strong>随着用户数的增长，Tomcat 和数据库之间竞争资源，单机性能不足以支撑业务。</p>
<h2 id="6、第一次演进：Tomcat-与数据库分开部署"><a href="#6、第一次演进：Tomcat-与数据库分开部署" class="headerlink" title="6、第一次演进：Tomcat 与数据库分开部署"></a>6、第一次演进：Tomcat 与数据库分开部署</h2><p><img src="../../images/java/arc3.jpeg" alt="从新手到架构师，一篇就够：从100到1000万高并发的架构演进之路"></p>
<p>Tomcat 和数据库分别独占服务器资源，显著提高两者各自性能。</p>
<p><strong>架构瓶颈：</strong>随着用户数的增长，并发读写数据库成为瓶颈。</p>
<h2 id="7、第二次演进：引入本地缓存和分布式缓存"><a href="#7、第二次演进：引入本地缓存和分布式缓存" class="headerlink" title="7、第二次演进：引入本地缓存和分布式缓存"></a>7、第二次演进：引入本地缓存和分布式缓存</h2><p><img src="../../images/java/arc4.jpeg" alt="从新手到架构师，一篇就够：从100到1000万高并发的架构演进之路"></p>
<p>在 Tomcat 同服务器上或同 JVM 中增加本地缓存，并在外部增加分布式缓存，缓存热门商品信息或热门商品的 html 页面等。通过缓存能把绝大多数请求在读写数据库前拦截掉，大大降低数据库压力。其中涉及的技术包括：使用 memcached 作为本地缓存，使用 Redis 作为分布式缓存，还会涉及缓存一致性、缓存穿透/击穿、缓存雪崩、热点数据集中失效等问题。</p>
<p><strong>架构瓶颈：</strong>缓存抗住了大部分的访问请求，随着用户数的增长，并发压力主要落在单机的 Tomcat 上，响应逐渐变慢。</p>
<h2 id="8、第三次演进：引入反向代理实现负载均衡"><a href="#8、第三次演进：引入反向代理实现负载均衡" class="headerlink" title="8、第三次演进：引入反向代理实现负载均衡"></a>8、第三次演进：引入反向代理实现负载均衡</h2><p><img src="../../images/java/arc5.jpeg" alt="从新手到架构师，一篇就够：从100到1000万高并发的架构演进之路"></p>
<p>在多台服务器上分别部署 Tomcat，使用反向代理软件（Nginx）把请求均匀分发到每个 Tomcat 中。此处假设 Tomcat 最多支持 100 个并发，Nginx 最多支持 50000 个并发，那么理论上 Nginx 把请求分发到 500 个 Tomcat 上，就能抗住 50000 个并发。</p>
<p>其中涉及的技术包括：Nginx、HAProxy，两者都是工作在网络第七层的反向代理软件，主要支持 http 协议，还会涉及 session 共享、文件上传下载的问题。</p>
<p><strong>架构瓶颈：</strong>反向代理使应用服务器可支持的并发量大大增加，但并发量的增长也意味着更多请求穿透到数据库，单机的数据库最终成为瓶颈。</p>
<h2 id="9、第四次演进：数据库读写分离"><a href="#9、第四次演进：数据库读写分离" class="headerlink" title="9、第四次演进：数据库读写分离"></a>9、第四次演进：数据库读写分离</h2><p><img src="../../images/java/arc6.jpeg" alt="从新手到架构师，一篇就够：从100到1000万高并发的架构演进之路"></p>
<p>把数据库划分为读库和写库，读库可以有多个，通过同步机制把写库的数据同步到读库，对于需要查询最新写入数据场景，可通过在缓存中多写一份，通过缓存获得最新数据。其中涉及的技术包括：Mycat，它是数据库中间件，可通过它来组织数据库的分离读写和分库分表，客户端通过它来访问下层数据库，还会涉及数据同步，数据一致性的问题。</p>
<p><strong>架构瓶颈：</strong>业务逐渐变多，不同业务之间的访问量差距较大，不同业务直接竞争数据库，相互影响性能。</p>
<h2 id="10、第五次演进：数据库按业务分库"><a href="#10、第五次演进：数据库按业务分库" class="headerlink" title="10、第五次演进：数据库按业务分库"></a>10、第五次演进：数据库按业务分库</h2><p><img src="../../images/java/arc7.jpeg" alt="从新手到架构师，一篇就够：从100到1000万高并发的架构演进之路"></p>
<p>把不同业务的数据保存到不同的数据库中，使业务之间的资源竞争降低，对于访问量大的业务，可以部署更多的服务器来支撑。这样同时导致跨业务的表无法直接做关联分析，需要通过其他途径来解决，但这不是本文讨论的重点，有兴趣的可以自行搜索解决方案。</p>
<p><strong>架构瓶颈：</strong>随着用户数的增长，单机的写库会逐渐会达到性能瓶颈。</p>
<h2 id="11、第六次演进：把大表拆分为小表"><a href="#11、第六次演进：把大表拆分为小表" class="headerlink" title="11、第六次演进：把大表拆分为小表"></a>11、第六次演进：把大表拆分为小表</h2><p><img src="../../images/java/arc8.jpeg" alt="从新手到架构师，一篇就够：从100到1000万高并发的架构演进之路"></p>
<p>比如针对评论数据，可按照商品 ID 进行 hash，路由到对应的表中存储；针对支付记录，可按照小时创建表，每个小时表继续拆分为小表，使用用户 ID 或记录编号来路由数据。只要实时操作的表数据量足够小，请求能够足够均匀的分发到多台服务器上的小表，那数据库就能通过水平扩展的方式来提高性能。其中前面提到的 Mycat 也支持在大表拆分为小表情况下的访问控制。</p>
<p>这种做法显著的增加了数据库运维的难度，对 DBA 的要求较高。数据库设计到这种结构时，已经可以称为分布式数据库，但是这只是一个逻辑的数据库整体，数据库里不同的组成部分是由不同的组件单独来实现的，如分库分表的管理和请求分发，由 Mycat 实现，SQL 的解析由单机的数据库实现，读写分离可能由网关和消息队列来实现，查询结果的汇总可能由数据库接口层来实现等等，这种架构其实是 MPP（大规模并行处理）架构的一类实现。</p>
<p>目前开源和商用都已经有不少 MPP 数据库，开源中比较流行的有 Greenplum、TiDB、Postgresql XC、HAWQ 等，商用的如南大通用的 GBase、睿帆科技的雪球 DB、华为的 LibrA 等等，不同的 MPP 数据库的侧重点也不一样，如 TiDB 更侧重于分布式 OLTP 场景，Greenplum 更侧重于分布式 OLAP 场景，这些 MPP 数据库基本都提供了类似 Postgresql、Oracle、MySQL 那样的 SQL 标准支持能力，能把一个查询解析为分布式的执行计划分发到每台机器上并行执行，最终由数据库本身汇总数据进行返回，也提供了诸如权限管理、分库分表、事务、数据副本等能力，并且大多能够支持 100 个节点以上的集群，大大降低了数据库运维的成本，并且使数据库也能够实现水平扩展。</p>
<p><strong>架构瓶颈：</strong>数据库和 Tomcat 都能够水平扩展，可支撑的并发大幅提高，随着用户数的增长，最终单机的 Nginx 会成为瓶颈。</p>
<h2 id="12、第七次演进：使用-LVS-或-F5-来使多个-Nginx-负载均衡"><a href="#12、第七次演进：使用-LVS-或-F5-来使多个-Nginx-负载均衡" class="headerlink" title="12、第七次演进：使用 LVS 或 F5 来使多个 Nginx 负载均衡"></a>12、第七次演进：使用 LVS 或 F5 来使多个 Nginx 负载均衡</h2><p><img src="../../images/java/arc9.jpeg" alt="从新手到架构师，一篇就够：从100到1000万高并发的架构演进之路"></p>
<p>由于瓶颈在 Nginx，因此无法通过两层的 Nginx 来实现多个 Nginx 的负载均衡。图中的 LVS 和 F5 是工作在网络第四层的负载均衡解决方案，其中 LVS 是软件，运行在操作系统内核态，可对 TCP 请求或更高层级的网络协议进行转发，因此支持的协议更丰富，并且性能也远高于 Nginx，可假设单机的 LVS 可支持几十万个并发的请求转发；F5 是一种负载均衡硬件，与 LVS 提供的能力类似，性能比 LVS 更高，但价格昂贵。由于 LVS 是单机版的软件，若 LVS 所在服务器宕机则会导致整个后端系统都无法访问，因此需要有备用节点。可使用 keepalived 软件模拟出虚拟 IP，然后把虚拟 IP 绑定到多台 LVS 服务器上，浏览器访问虚拟 IP 时，会被路由器重定向到真实的 LVS 服务器，当主 LVS 服务器宕机时，keepalived 软件会自动更新路由器中的路由表，把虚拟 IP 重定向到另外一台正常的 LVS 服务器，从而达到 LVS 服务器高可用的效果。</p>
<p>此处需要注意的是，上图中从 Nginx 层到 Tomcat 层这样画并不代表全部 Nginx 都转发请求到全部的 Tomcat，在实际使用时，可能会是几个 Nginx 下面接一部分的 Tomcat，这些 Nginx 之间通过 keepalived 实现高可用，其他的 Nginx 接另外的 Tomcat，这样可接入的 Tomcat 数量就能成倍的增加。</p>
<p><strong>架构瓶颈：</strong>由于 LVS 也是单机的，随着并发数增长到几十万时，LVS 服务器最终会达到瓶颈，此时用户数达到千万甚至上亿级别，用户分布在不同的地区，与服务器机房距离不同，导致了访问的延迟会明显不同。</p>
<h2 id="13、第八次演进：通过-DNS-轮询实现机房间的负载均衡"><a href="#13、第八次演进：通过-DNS-轮询实现机房间的负载均衡" class="headerlink" title="13、第八次演进：通过 DNS 轮询实现机房间的负载均衡"></a>13、第八次演进：通过 DNS 轮询实现机房间的负载均衡</h2><p><img src="../../images/java/arc10.jpeg" alt="从新手到架构师，一篇就够：从100到1000万高并发的架构演进之路"></p>
<p>在 DNS 服务器中可配置一个域名对应多个 IP 地址，每个 IP 地址对应到不同的机房里的虚拟 IP。当用户访问 <a href="http://www.taobao.com" target="_blank" rel="noopener">www.taobao.com</a> 时，DNS 服务器会使用轮询策略或其他策略，来选择某个 IP 供用户访问。此方式能实现机房间的负载均衡，至此，系统可做到机房级别的水平扩展，千万级到亿级的并发量都可通过增加机房来解决，系统入口处的请求并发量不再是问题。</p>
<p><strong>架构瓶颈：</strong>随着数据的丰富程度和业务的发展，检索、分析等需求越来越丰富，单单依靠数据库无法解决如此丰富的需求。</p>
<h2 id="14、第九次演进：引入-NoSQL-数据库和搜索引擎等技术"><a href="#14、第九次演进：引入-NoSQL-数据库和搜索引擎等技术" class="headerlink" title="14、第九次演进：引入 NoSQL 数据库和搜索引擎等技术"></a>14、第九次演进：引入 NoSQL 数据库和搜索引擎等技术</h2><p><img src="../../images/java/arc11.jpeg" alt="从新手到架构师，一篇就够：从100到1000万高并发的架构演进之路"></p>
<p>当数据库中的数据多到一定规模时，数据库就不适用于复杂的查询了，往往只能满足普通查询的场景。对于统计报表场景，在数据量大时不一定能跑出结果，而且在跑复杂查询时会导致其他查询变慢，对于全文检索、可变数据结构等场景，数据库天生不适用。因此需要针对特定的场景，引入合适的解决方案。如对于海量文件存储，可通过分布式文件系统 HDFS 解决，对于 key value 类型的数据，可通过 HBase 和 Redis 等方案解决，对于全文检索场景，可通过搜索引擎如 ElasticSearch 解决，对于多维分析场景，可通过 Kylin 或 Druid 等方案解决。</p>
<p>当然，引入更多组件同时会提高系统的复杂度，不同的组件保存的数据需要同步，需要考虑一致性的问题，需要有更多的运维手段来管理这些组件等。</p>
<p><strong>架构瓶颈：</strong>引入更多组件解决了丰富的需求，业务维度能够极大扩充，随之而来的是一个应用中包含了太多的业务代码，业务的升级迭代变得困难。</p>
<h2 id="15、第十次演进：大应用拆分为小应用"><a href="#15、第十次演进：大应用拆分为小应用" class="headerlink" title="15、第十次演进：大应用拆分为小应用"></a>15、第十次演进：大应用拆分为小应用</h2><p><img src="../../images/java/arc12.jpeg" alt="从新手到架构师，一篇就够：从100到1000万高并发的架构演进之路"></p>
<p>按照业务板块来划分应用代码，使单个应用的职责更清晰，相互之间可以做到独立升级迭代。这时候应用之间可能会涉及到一些公共配置，可以通过分布式配置中心 Zookeeper 来解决。</p>
<p><strong>架构瓶颈：</strong>不同应用之间存在共用的模块，由应用单独管理会导致相同代码存在多份，导致公共功能升级时全部应用代码都要跟着升级。</p>
<h2 id="16、第十一次演进：复用的功能抽离成微服务"><a href="#16、第十一次演进：复用的功能抽离成微服务" class="headerlink" title="16、第十一次演进：复用的功能抽离成微服务"></a>16、第十一次演进：复用的功能抽离成微服务</h2><p><img src="../../images/java/arc13.jpeg" alt="从新手到架构师，一篇就够：从100到1000万高并发的架构演进之路"></p>
<p>如用户管理、订单、支付、鉴权等功能在多个应用中都存在，那么可以把这些功能的代码单独抽取出来形成一个单独的服务来管理，这样的服务就是所谓的微服务，应用和服务之间通过 HTTP、TCP 或 RPC 请求等多种方式来访问公共服务，每个单独的服务都可以由单独的团队来管理。此外，可以通过 Dubbo、SpringCloud 等框架实现服务治理、限流、熔断、降级等功能，提高服务的稳定性和可用性。</p>
<p><strong>架构瓶颈：</strong>不同服务的接口访问方式不同，应用代码需要适配多种访问方式才能使用服务，此外，应用访问服务，服务之间也可能相互访问，调用链将会变得非常复杂，逻辑变得混乱。</p>
<h2 id="17、第十二次演进：引入企业服务总线-ESB-屏蔽服务接口的访问差异"><a href="#17、第十二次演进：引入企业服务总线-ESB-屏蔽服务接口的访问差异" class="headerlink" title="17、第十二次演进：引入企业服务总线 ESB 屏蔽服务接口的访问差异"></a>17、第十二次演进：引入企业服务总线 ESB 屏蔽服务接口的访问差异</h2><p><img src="../../images/java/arc14.jpeg" alt="从新手到架构师，一篇就够：从100到1000万高并发的架构演进之路"></p>
<p>通过 ESB 统一进行访问协议转换，应用统一通过 ESB 来访问后端服务，服务与服务之间也通过 ESB 来相互调用，以此降低系统的耦合程度。</p>
<p>这种单个应用拆分为多个应用，公共服务单独抽取出来来管理，并使用企业消息总线来解除服务之间耦合问题的架构，就是所谓的 SOA（面向服务）架构，这种架构与微服务架构容易混淆，因为表现形式十分相似。</p>
<p>个人理解，微服务架构更多是指把系统里的公共服务抽取出来单独运维管理的思想，而 SOA 架构则是指一种拆分服务并使服务接口访问变得统一的架构思想，SOA 架构中包含了微服务的思想。</p>
<p><strong>架构瓶颈：</strong>业务不断发展，应用和服务都会不断变多，应用和服务的部署变得复杂，同一台服务器上部署多个服务还要解决运行环境冲突的问题，此外，对于如大促这类需要动态扩缩容的场景，需要水平扩展服务的性能，就需要在新增的服务上准备运行环境，部署服务等，运维将变得十分困难。</p>
<h2 id="18、第十三次演进：引入容器化技术实现运行环境隔离与动态服务管理"><a href="#18、第十三次演进：引入容器化技术实现运行环境隔离与动态服务管理" class="headerlink" title="18、第十三次演进：引入容器化技术实现运行环境隔离与动态服务管理"></a>18、第十三次演进：引入容器化技术实现运行环境隔离与动态服务管理</h2><p><img src="../../images/java/arc15.jpeg" alt="从新手到架构师，一篇就够：从100到1000万高并发的架构演进之路"></p>
<p>目前最流行的容器化技术是 Docker，最流行的容器管理服务是 Kubernetes(K8S)，应用/服务可以打包为 Docker 镜像，通过 K8S 来动态分发和部署镜像。Docker 镜像可理解为一个能运行你的应用/服务的最小的操作系统，里面放着应用/服务的运行代码，运行环境根据实际的需要设置好。把整个“操作系统”打包为一个镜像后，就可以分发到需要部署相关服务的机器上，直接启动 Docker 镜像就可以把服务起起来，使服务的部署和运维变得简单。</p>
<p>在大促的之前，可以在现有的机器集群上划分出服务器来启动 Docker 镜像，增强服务的性能，大促过后就可以关闭镜像，对机器上的其他服务不造成影响（在第 18 节之前，服务运行在新增机器上需要修改系统配置来适配服务，这会导致机器上其他服务需要的运行环境被破坏）。</p>
<p><strong>架构瓶颈：</strong>使用容器化技术后服务动态扩缩容问题得以解决，但是机器还是需要公司自身来管理，在非大促的时候，还是需要闲置着大量的机器资源来应对大促，机器自身成本和运维成本都极高，资源利用率低。</p>
<h2 id="19、第十四次演进：以云平台承载系统"><a href="#19、第十四次演进：以云平台承载系统" class="headerlink" title="19、第十四次演进：以云平台承载系统"></a>19、第十四次演进：以云平台承载系统</h2><p><img src="../../images/java/arc16.jpeg" alt="从新手到架构师，一篇就够：从100到1000万高并发的架构演进之路"></p>
<p>系统可部署到公有云上，利用公有云的海量机器资源，解决动态硬件资源的问题，在大促的时间段里，在云平台中临时申请更多的资源，结合 Docker 和 K8S 来快速部署服务，在大促结束后释放资源，真正做到按需付费，资源利用率大大提高，同时大大降低了运维成本。</p>
<p>所谓的云平台，就是把海量机器资源，通过统一的资源管理，抽象为一个资源整体，在之上可按需动态申请硬件资源（如 CPU、内存、网络等），并且之上提供通用的操作系统，提供常用的技术组件（如 Hadoop 技术栈，MPP 数据库等）供用户使用，甚至提供开发好的应用，用户不需要关系应用内部使用了什么技术，就能够解决需求（如音视频转码服务、邮件服务、个人博客等）。</p>
<p><strong>在云平台中会涉及如下几个概念：</strong></p>
<p>1）IaaS：基础设施即服务。对应于上面所说的机器资源统一为资源整体，可动态申请硬件资源的层面；</p>
<p>2）PaaS：平台即服务。对应于上面所说的提供常用的技术组件方便系统的开发和维护；</p>
<p>3）SaaS：软件即服务。对应于上面所说的提供开发好的应用或服务，按功能或性能要求付费。</p>
<p><strong>至此：</strong>以上所提到的从高并发访问问题，到服务的架构和系统实施的层面都有了各自的解决方案。但同时也应该意识到，在上面的介绍中，其实是有意忽略了诸如跨机房数据同步、分布式事务实现等等的实际问题，这些问题以后有机会再拿出来单独讨论。</p>
<h2 id="20、架构设计经验小结"><a href="#20、架构设计经验小结" class="headerlink" title="20、架构设计经验小结"></a>20、架构设计经验小结</h2><p><strong><em>1）架构的调整是否必须按照上述演变路径进行？</em></strong></p>
<p>不是的，以上所说的架构演变顺序只是针对某个侧面进行单独的改进，在实际场景中，可能同一时间会有几个问题需要解决，或者可能先达到瓶颈的是另外的方面，这时候就应该按照实际问题实际解决。如在政府类的并发量可能不大，但业务可能很丰富的场景，高并发就不是重点解决的问题，此时优先需要的可能会是丰富需求的解决方案。</p>
<p><strong><em>2）对于将要实施的系统，架构应该设计到什么程度？</em></strong></p>
<p>对于单次实施并且性能指标明确的系统，架构设计到能够支持系统的性能指标要求就足够了，但要留有扩展架构的接口以便不备之需。对于不断发展的系统，如电商平台，应设计到能满足下一阶段用户量和性能指标要求的程度，并根据业务的增长不断的迭代升级架构，以支持更高的并发和更丰富的业务。</p>
<p><strong><em>3）服务端架构和大数据架构有什么区别？</em></strong></p>
<p>所谓的“大数据”其实是海量数据采集清洗转换、数据存储、数据分析、数据服务等场景解决方案的一个统称，在每一个场景都包含了多种可选的技术，如数据采集有 Flume、Sqoop、Kettle 等，数据存储有分布式文件系统 HDFS、FastDFS，NoSQL 数据库 HBase、MongoDB 等，数据分析有 Spark 技术栈、机器学习算法等。总的来说大数据架构就是根据业务的需求，整合各种大数据组件组合而成的架构，一般会提供分布式存储、分布式计算、多维分析、数据仓库、机器学习算法等能力。而服务端架构更多指的是应用组织层面的架构，底层能力往往是由大数据架构来提供。</p>
<p><strong><em>4）有没有一些架构设计的原则？</em></strong></p>
<p>a. N+1 设计：系统中的每个组件都应做到没有单点故障；</p>
<p>b. 回滚设计：确保系统可以向前兼容，在系统升级时应能有办法回滚版本；</p>
<p>c. 禁用设计：应该提供控制具体功能是否可用的配置，在系统出现故障时能够快速下线功能；</p>
<p>d. 监控设计：在设计阶段就要考虑监控的手段；</p>
<p>e. 多活数据中心设计：若系统需要极高的高可用，应考虑在多地实施数据中心进行多活，至少在一个机房断电的情况下系统依然可用；</p>
<p>f. 采用成熟的技术：刚开发的或开源的技术往往存在很多隐藏的 bug，出了问题没有商业支持可能会是一个灾难；</p>
<p>g. 资源隔离设计：应避免单一业务占用全部资源；</p>
<p>h. 架构应能水平扩展：系统只有做到能水平扩展，才能有效避免瓶颈问题；</p>
<p>i. 非核心则购买：非核心功能若需要占用大量的研发资源才能解决，则考虑购买成熟的产品；</p>
<p>j. 使用商用硬件：商用硬件能有效降低硬件故障的机率；</p>
<p>k. 快速迭代：系统应该快速开发小功能模块，尽快上线进行验证，早日发现问题大大降低系统交付的风险；</p>
<p>l. 无状态设计：服务接口应该做成无状态的，当前接口的访问不依赖于接口上次访问的状态。</p>
<h2 id="附录：更多架构设计方面的文章"><a href="#附录：更多架构设计方面的文章" class="headerlink" title="附录：更多架构设计方面的文章"></a>附录：更多架构设计方面的文章</h2><p><strong>[1] 更多其它架构设计相关文章：</strong></p>
<p>《<a href="http://www.52im.net/thread-1811-1-1.html" target="_blank" rel="noopener">腾讯资深架构师干货总结：一文读懂大型分布式系统设计的方方面面</a>》</p>
<p>《<a href="http://www.52im.net/thread-1950-1-1.html" target="_blank" rel="noopener">快速理解高性能 HTTP 服务端的负载均衡技术原理</a>》</p>
<p>《<a href="http://www.52im.net/thread-1961-1-1.html" target="_blank" rel="noopener">子弹短信光鲜的背后：网易云信首席架构师分享亿级 IM 平台的技术实践</a>》</p>
<p>《<a href="http://www.52im.net/thread-1968-1-1.html" target="_blank" rel="noopener">知乎技术分享：从单机到 2000 万 QPS 并发的 Redis 高性能缓存实践之路</a>》</p>
<p>《<a href="http://www.52im.net/thread-2007-1-1.html" target="_blank" rel="noopener">新手入门：零基础理解大型分布式架构的演进历史、技术原理、最佳实践</a>》</p>
<p>《<a href="http://www.52im.net/thread-2050-1-1.html" target="_blank" rel="noopener">阿里技术分享：深度揭秘阿里数据库技术方案的 10 年变迁史</a>》</p>
<p>《<a href="http://www.52im.net/thread-2072-1-1.html" target="_blank" rel="noopener">阿里技术分享：阿里自研金融级数据库 OceanBase 的艰辛成长之路</a>》</p>
<p>《<a href="http://www.52im.net/thread-2141-1-1.html" target="_blank" rel="noopener">达达 O2O 后台架构演进实践：从 0 到 4000 高并发请求背后的努力</a>》</p>
<p>《<a href="http://www.52im.net/thread-2157-1-1.html" target="_blank" rel="noopener">优秀后端架构师必会知识：史上最全 MySQL 大表优化方案总结</a>》</p>
<p>《<a href="http://www.52im.net/thread-2323-1-1.html" target="_blank" rel="noopener">小米技术分享：解密小米抢购系统千万高并发架构的演进和实践</a>》</p>
<p>《<a href="http://www.52im.net/thread-2494-1-1.html" target="_blank" rel="noopener">一篇读懂分布式架构下的负载均衡技术：分类、原理、算法、常见方案等</a>》</p>
<p>《<a href="http://www.52im.net/thread-2510-1-1.html" target="_blank" rel="noopener">通俗易懂：如何设计能支撑百万并发的数据库架构？</a>》</p>
<p>《<a href="http://www.52im.net/thread-2625-1-1.html" target="_blank" rel="noopener">多维度对比 5 款主流分布式 MQ 消息队列，妈妈再也不担心我的技术选型了</a>》</p>
<p>《<a href="http://www.52im.net/thread-2665-1-1.html" target="_blank" rel="noopener">从新手到架构师，一篇就够：从 100 到 1000 万高并发的架构演进之路</a>》</p>
<blockquote>
<blockquote>
<p><a href="http://www.52im.net/forum.php?mod=collection&action=view&ctid=22" target="_blank" rel="noopener">更多同类文章 ……</a></p>
</blockquote>
</blockquote>
<p><strong>[2] 有关 IM 架构设计的文章：</strong></p>
<p>《<a href="http://www.52im.net/thread-307-1-1.html" target="_blank" rel="noopener">浅谈 IM 系统的架构设计</a>》</p>
<p>《<a href="http://www.52im.net/thread-289-1-1.html" target="_blank" rel="noopener">简述移动端 IM 开发的那些坑：架构设计、通信协议和客户端</a>》</p>
<p>《<a href="http://www.52im.net/thread-812-1-1.html" target="_blank" rel="noopener">一套海量在线用户的移动端 IM 架构设计实践分享(含详细图文)</a>》</p>
<p>《<a href="http://www.52im.net/thread-151-1-1.html" target="_blank" rel="noopener">一套原创分布式即时通讯(IM)系统理论架构方案</a>》</p>
<p>《<a href="http://www.52im.net/thread-152-1-1.html" target="_blank" rel="noopener">从零到卓越：京东客服即时通讯系统的技术架构演进历程</a>》</p>
<p>《<a href="http://www.52im.net/thread-31-1-1.html" target="_blank" rel="noopener">蘑菇街即时通讯/IM 服务器开发之架构选择</a>》</p>
<p>《<a href="http://www.52im.net/thread-158-1-1.html" target="_blank" rel="noopener">腾讯 QQ1.4 亿在线用户的技术挑战和架构演进之路 PPT</a>》</p>
<p>《<a href="http://www.52im.net/thread-895-1-1.html" target="_blank" rel="noopener">微信后台基于时间序的海量数据冷热分级架构设计实践</a>》</p>
<p>《<a href="http://www.52im.net/thread-200-1-1.html" target="_blank" rel="noopener">微信技术总监谈架构：微信之道——大道至简(演讲全文)</a>》</p>
<p>《<a href="http://www.52im.net/thread-201-1-1.html" target="_blank" rel="noopener">如何解读《微信技术总监谈架构：微信之道——大道至简》</a>》</p>
<p>《<a href="http://www.52im.net/thread-168-1-1.html" target="_blank" rel="noopener">快速裂变：见证微信强大后台架构从 0 到 1 的演进历程（一）</a>》</p>
<p>《<a href="http://www.52im.net/thread-159-1-1.html" target="_blank" rel="noopener">17 年的实践：腾讯海量产品的技术方法论</a>》</p>
<p>《<a href="http://www.52im.net/thread-1221-1-1.html" target="_blank" rel="noopener">移动端 IM 中大规模群消息的推送如何保证效率、实时性？</a>》</p>
<p>《<a href="http://www.52im.net/thread-1230-1-1.html" target="_blank" rel="noopener">现代 IM 系统中聊天消息的同步和存储方案探讨</a>》</p>
<p>《<a href="http://www.52im.net/thread-1356-1-1.html" target="_blank" rel="noopener">IM 开发基础知识补课(二)：如何设计大量图片文件的服务端存储架构？</a>》</p>
<p>《<a href="http://www.52im.net/thread-1366-1-1.html" target="_blank" rel="noopener">IM 开发基础知识补课(三)：快速理解服务端数据库读写分离原理及实践建议</a>》</p>
<p>《<a href="http://www.52im.net/thread-1525-1-1.html" target="_blank" rel="noopener">IM 开发基础知识补课(四)：正确理解 HTTP 短连接中的 Cookie、Session 和 Token</a>》</p>
<p>《<a href="http://www.52im.net/thread-1542-1-1.html" target="_blank" rel="noopener">WhatsApp 技术实践分享：32 人工程团队创造的技术神话</a>》</p>
<p>《<a href="http://www.52im.net/thread-1569-1-1.html" target="_blank" rel="noopener">微信朋友圈千亿访问量背后的技术挑战和实践总结</a>》</p>
<p>《<a href="http://www.52im.net/thread-1595-1-1.html" target="_blank" rel="noopener">王者荣耀 2 亿用户量的背后：产品定位、技术架构、网络方案等</a>》</p>
<p>《<a href="http://www.52im.net/thread-1647-1-1.html" target="_blank" rel="noopener">IM 系统的 MQ 消息中间件选型：Kafka 还是 RabbitMQ？</a>》</p>
<p>《<a href="http://www.52im.net/thread-1811-1-1.html" target="_blank" rel="noopener">腾讯资深架构师干货总结：一文读懂大型分布式系统设计的方方面面</a>》</p>
<p>《<a href="http://www.52im.net/thread-1910-1-1.html" target="_blank" rel="noopener">以微博类应用场景为例，总结海量社交系统的架构设计步骤</a>》</p>
<p>《<a href="http://www.52im.net/thread-1950-1-1.html" target="_blank" rel="noopener">快速理解高性能 HTTP 服务端的负载均衡技术原理</a>》</p>
<p>《<a href="http://www.52im.net/thread-1961-1-1.html" target="_blank" rel="noopener">子弹短信光鲜的背后：网易云信首席架构师分享亿级 IM 平台的技术实践</a>》</p>
<p>《<a href="http://www.52im.net/thread-1968-1-1.html" target="_blank" rel="noopener">知乎技术分享：从单机到 2000 万 QPS 并发的 Redis 高性能缓存实践之路</a>》</p>
<p>《<a href="http://www.52im.net/thread-1979-1-1.html" target="_blank" rel="noopener">IM 开发基础知识补课(五)：通俗易懂，正确理解并用好 MQ 消息队列</a>》</p>
<p>《<a href="http://www.52im.net/thread-1998-1-1.html" target="_blank" rel="noopener">微信技术分享：微信的海量 IM 聊天消息序列号生成实践（算法原理篇）</a>》</p>
<p>《<a href="http://www.52im.net/thread-1999-1-1.html" target="_blank" rel="noopener">微信技术分享：微信的海量 IM 聊天消息序列号生成实践（容灾方案篇）</a>》</p>
<p>《<a href="http://www.52im.net/thread-2007-1-1.html" target="_blank" rel="noopener">新手入门：零基础理解大型分布式架构的演进历史、技术原理、最佳实践</a>》</p>
<p>《<a href="http://www.52im.net/thread-2015-1-1.html" target="_blank" rel="noopener">一套高可用、易伸缩、高并发的 IM 群聊、单聊架构方案设计实践</a>》</p>
<p>《<a href="http://www.52im.net/thread-2050-1-1.html" target="_blank" rel="noopener">阿里技术分享：深度揭秘阿里数据库技术方案的 10 年变迁史</a>》</p>
<p>《<a href="http://www.52im.net/thread-2072-1-1.html" target="_blank" rel="noopener">阿里技术分享：阿里自研金融级数据库 OceanBase 的艰辛成长之路</a>》</p>
<p>《<a href="http://www.52im.net/thread-2202-1-1.html" target="_blank" rel="noopener">社交软件红包技术解密(一)：全面解密 QQ 红包技术方案——架构、技术实现等</a>》</p>
<p>《<a href="http://www.52im.net/thread-2519-1-1.html" target="_blank" rel="noopener">社交软件红包技术解密(二)：解密微信摇一摇红包从 0 到 1 的技术演进</a>》</p>
<p>《<a href="http://www.52im.net/thread-2533-1-1.html" target="_blank" rel="noopener">社交软件红包技术解密(三)：微信摇一摇红包雨背后的技术细节</a>》</p>
<p>《<a href="http://www.52im.net/thread-2548-1-1.html" target="_blank" rel="noopener">社交软件红包技术解密(四)：微信红包系统是如何应对高并发的</a>》</p>
<p>《<a href="http://www.52im.net/thread-2564-1-1.html" target="_blank" rel="noopener">社交软件红包技术解密(五)：微信红包系统是如何实现高可用性的</a>》</p>
<p>《<a href="http://www.52im.net/thread-2568-1-1.html" target="_blank" rel="noopener">社交软件红包技术解密(六)：微信红包系统的存储层架构演进实践</a>》</p>
<p>《<a href="http://www.52im.net/thread-2573-1-1.html" target="_blank" rel="noopener">社交软件红包技术解密(七)：支付宝红包的海量高并发技术实践</a>》</p>
<p>《<a href="http://www.52im.net/thread-2576-1-1.html" target="_blank" rel="noopener">社交软件红包技术解密(八)：全面解密微博红包技术方案</a>》</p>
<p>《<a href="http://www.52im.net/thread-2583-1-1.html" target="_blank" rel="noopener">社交软件红包技术解密(九)：谈谈手 Q 红包的功能逻辑、容灾、运维、架构等</a>》</p>
<p>《<a href="http://www.52im.net/thread-2600-1-1.html" target="_blank" rel="noopener">即时通讯新手入门：一文读懂什么是 Nginx？它能否实现 IM 的负载均衡？</a>》</p>
<p>《<a href="http://www.52im.net/thread-2620-1-1.html" target="_blank" rel="noopener">即时通讯新手入门：快速理解 RPC 技术——基本概念、原理和用途</a>》</p>
<p>《<a href="http://www.52im.net/thread-2625-1-1.html" target="_blank" rel="noopener">多维度对比 5 款主流分布式 MQ 消息队列，妈妈再也不担心我的技术选型了</a>》</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/java/" rel="tag"># java</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/07/18/pig/Java%E6%8A%80%E6%9C%AF%E9%9D%A2%E8%AF%95%E7%AD%94%E6%A1%88%E6%B1%87%E6%80%BB%E7%89%88/" rel="prev" title="Java技术面试答案汇总版">
      <i class="fa fa-chevron-left"></i> Java技术面试答案汇总版
    </a></div>
      <div class="post-nav-item">
    <a href="/2019/07/19/spring/spring%E5%AE%B9%E5%99%A8%E4%B8%AD%E7%9A%84Bean%E6%98%AF%E5%90%A6%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8/" rel="next" title="spring容器中的Bean是否线程安全">
      spring容器中的Bean是否线程安全 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1、引言"><span class="nav-number">1.</span> <span class="nav-text">1、引言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、关于作者"><span class="nav-number">2.</span> <span class="nav-text">2、关于作者</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3、相关文章"><span class="nav-number">3.</span> <span class="nav-text">3、相关文章</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4、基本概念"><span class="nav-number">4.</span> <span class="nav-text">4、基本概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5、纯真年代：单机架构"><span class="nav-number">5.</span> <span class="nav-text">5、纯真年代：单机架构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6、第一次演进：Tomcat-与数据库分开部署"><span class="nav-number">6.</span> <span class="nav-text">6、第一次演进：Tomcat 与数据库分开部署</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7、第二次演进：引入本地缓存和分布式缓存"><span class="nav-number">7.</span> <span class="nav-text">7、第二次演进：引入本地缓存和分布式缓存</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8、第三次演进：引入反向代理实现负载均衡"><span class="nav-number">8.</span> <span class="nav-text">8、第三次演进：引入反向代理实现负载均衡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9、第四次演进：数据库读写分离"><span class="nav-number">9.</span> <span class="nav-text">9、第四次演进：数据库读写分离</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10、第五次演进：数据库按业务分库"><span class="nav-number">10.</span> <span class="nav-text">10、第五次演进：数据库按业务分库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11、第六次演进：把大表拆分为小表"><span class="nav-number">11.</span> <span class="nav-text">11、第六次演进：把大表拆分为小表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12、第七次演进：使用-LVS-或-F5-来使多个-Nginx-负载均衡"><span class="nav-number">12.</span> <span class="nav-text">12、第七次演进：使用 LVS 或 F5 来使多个 Nginx 负载均衡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13、第八次演进：通过-DNS-轮询实现机房间的负载均衡"><span class="nav-number">13.</span> <span class="nav-text">13、第八次演进：通过 DNS 轮询实现机房间的负载均衡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14、第九次演进：引入-NoSQL-数据库和搜索引擎等技术"><span class="nav-number">14.</span> <span class="nav-text">14、第九次演进：引入 NoSQL 数据库和搜索引擎等技术</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15、第十次演进：大应用拆分为小应用"><span class="nav-number">15.</span> <span class="nav-text">15、第十次演进：大应用拆分为小应用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#16、第十一次演进：复用的功能抽离成微服务"><span class="nav-number">16.</span> <span class="nav-text">16、第十一次演进：复用的功能抽离成微服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#17、第十二次演进：引入企业服务总线-ESB-屏蔽服务接口的访问差异"><span class="nav-number">17.</span> <span class="nav-text">17、第十二次演进：引入企业服务总线 ESB 屏蔽服务接口的访问差异</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#18、第十三次演进：引入容器化技术实现运行环境隔离与动态服务管理"><span class="nav-number">18.</span> <span class="nav-text">18、第十三次演进：引入容器化技术实现运行环境隔离与动态服务管理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#19、第十四次演进：以云平台承载系统"><span class="nav-number">19.</span> <span class="nav-text">19、第十四次演进：以云平台承载系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#20、架构设计经验小结"><span class="nav-number">20.</span> <span class="nav-text">20、架构设计经验小结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#附录：更多架构设计方面的文章"><span class="nav-number">21.</span> <span class="nav-text">附录：更多架构设计方面的文章</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Andy Ge</p>
  <div class="site-description" itemprop="description">勇于积极进取，步入人生的世外桃源</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">728</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">134</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">315</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/andyge" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;andyge" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:geshaofei@126.com" title="E-Mail → mailto:geshaofei@126.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-link"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://www.ruanyifeng.com/" title="http:&#x2F;&#x2F;www.ruanyifeng.com&#x2F;" rel="noopener" target="_blank">阮一峰</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://colobu.com/" title="http:&#x2F;&#x2F;colobu.com&#x2F;" rel="noopener" target="_blank">鸟窝</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.cnblogs.com/hellokuangshen/" title="https:&#x2F;&#x2F;www.cnblogs.com&#x2F;hellokuangshen&#x2F;" rel="noopener" target="_blank">狂神</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://yelog.org/" title="https:&#x2F;&#x2F;yelog.org&#x2F;" rel="noopener" target="_blank">叶落阁</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Andy Ge</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.7.1
  </div>

        






  <script>
  function leancloudSelector(url) {
    url = encodeURI(url);
    return document.getElementById(url).querySelector('.leancloud-visitors-count');
  }
  if (CONFIG.page.isPost) {
    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.getAttribute('id'));
      var title = visitors.getAttribute('data-flag-title');

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .then(response => response.json())
              .then(() => {
                leancloudSelector(url).innerText = counter.time + 1;
              })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              })
          } else {
              Counter('post', '/classes/Counter', { title: title, url: url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.error('Failed to create', error);
                });
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }
  } else {
    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.getAttribute('id'));
      });

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url: { '$in': entries } })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length === 0) {
            document.querySelectorAll('.leancloud_visitors .leancloud-visitors-count').forEach(element => {
              element.innerText = 0;
            });
            return;
          }
          for (let item of results) {
            let { url, time } = item;
            leancloudSelector(url).innerText = time;
          }
          for (let url of entries) {
            var element = leancloudSelector(url);
            if (element.innerText == '') {
              element.innerText = 0;
            }
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }
  }

  fetch('https://app-router.leancloud.cn/2/route?appId=2TdIb5gRlAVUw24l2W0zWnCj-gzGzoHsz')
    .then(response => response.json())
    .then(({ api_server }) => {
      var Counter = (method, url, data) => {
        return fetch(`https://${api_server}/1.1${url}`, {
          method: method,
          headers: {
            'X-LC-Id'     : '2TdIb5gRlAVUw24l2W0zWnCj-gzGzoHsz',
            'X-LC-Key'    : 'cJdJrMLBXsj0ttq0WsL0aA2j',
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    });
  </script>


      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
